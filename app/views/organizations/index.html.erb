<div style="padding: var(--space-lg);">
  <!-- Page Header -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl);">
    <div>
      <h1 class="typo-h1" style="margin-bottom: var(--space-sm);">üè¢ Organisations</h1>
      <p class="typo-body" style="color: #666;">G√©rez les entreprises et prestataires de votre portefeuille</p>
    </div>
    <%= link_to new_organization_path, class: "typo-btn-success", style: "display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Nouvelle Organisation
    <% end %>
  </div>

  <!-- Filters -->
  <div style="background: linear-gradient(135deg, var(--purple-primary) 0%, var(--pink-primary) 100%); padding: var(--space-lg); border-radius: var(--space-md); margin-bottom: var(--space-xl);">
    <%= form_with url: organizations_path, method: :get, local: true do |f| %>
      <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: var(--space-md); align-items: end;">
        <div>
          <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm); color: white;">
            Recherche
          </label>
          <%= f.text_field :search, value: params[:search], placeholder: "Nom, raison sociale ou SIRET...", style: "width: 100%;" %>
        </div>

        <div>
          <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm); color: white;">
            Type
          </label>
          <%= f.select :organization_type,
            Organization::ORGANIZATION_TYPES,
            { include_blank: 'Tous les types' },
            { style: "width: 100%;" } %>
        </div>

        <div style="display: flex; gap: var(--space-sm);">
          <%= f.submit "Filtrer", class: "typo-btn-primary", style: "cursor: pointer; white-space: nowrap;" %>
          <%= link_to "R√©initialiser", organizations_path, class: "typo-btn-cancel", style: "white-space: nowrap;" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Statistics -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: var(--space-lg); border-radius: var(--space-md); color: white;">
      <div class="typo-h2" style="margin-bottom: var(--space-sm);"><%= @organizations.total_count %></div>
      <div class="typo-body-small">Total Organisations</div>
    </div>
    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: var(--space-lg); border-radius: var(--space-md); color: white;">
      <div class="typo-h2" style="margin-bottom: var(--space-sm);"><%= Organization.active.count %></div>
      <div class="typo-body-small">Actives</div>
    </div>
    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: var(--space-lg); border-radius: var(--space-md); color: white;">
      <div class="typo-h2" style="margin-bottom: var(--space-sm);"><%= Organization.by_type('service_provider').count %></div>
      <div class="typo-body-small">Prestataires</div>
    </div>
  </div>

  <!-- Organizations Table -->
  <div style="background-color: var(--white); border-radius: var(--space-md); overflow: hidden;">
    <% if @organizations.any? %>
      <table style="width: 100%; border-collapse: collapse;">
        <thead style="background: linear-gradient(135deg, var(--purple-primary) 0%, var(--pink-primary) 100%);">
          <tr>
            <th style="padding: var(--space-md); text-align: left; color: white; font-weight: 600;">Organisation</th>
            <th style="padding: var(--space-md); text-align: left; color: white; font-weight: 600;">Type</th>
            <th style="padding: var(--space-md); text-align: left; color: white; font-weight: 600;">Sp√©cialit√©s</th>
            <th style="padding: var(--space-md); text-align: left; color: white; font-weight: 600;">Contact</th>
            <th style="padding: var(--space-md); text-align: left; color: white; font-weight: 600;">Statut</th>
            <th style="padding: var(--space-md); text-align: center; color: white; font-weight: 600;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @organizations.each do |organization| %>
            <tr style="border-bottom: 1px solid var(--pink-pale);">
              <td style="padding: var(--space-md);">
                <div>
                  <div class="typo-body-small typo-bold" style="margin-bottom: 4px;">
                    <%= link_to organization.name, organization_path(organization), style: "color: var(--purple-primary); text-decoration: none;" %>
                  </div>
                  <% if organization.legal_name.present? %>
                    <div class="typo-body-small" style="color: #666; font-size: 0.75rem;"><%= organization.legal_name %></div>
                  <% end %>
                  <% if organization.siret.present? %>
                    <div class="typo-body-small" style="color: #999; font-size: 0.7rem;">SIRET: <%= organization.formatted_siret %></div>
                  <% end %>
                </div>
              </td>
              <td style="padding: var(--space-md);">
                <% if organization.organization_type.present? %>
                  <span style="background-color: var(--purple-pale); color: var(--purple-primary); padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; white-space: nowrap;">
                    <%= organization.type_label %>
                  </span>
                <% else %>
                  <span style="color: #999;">‚Äî</span>
                <% end %>
              </td>
              <td style="padding: var(--space-md);">
                <div class="typo-body-small" style="color: #666; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                  <%= organization.specialties.present? ? organization.specialties : "‚Äî" %>
                </div>
              </td>
              <td style="padding: var(--space-md);">
                <div>
                  <% if organization.phone.present? %>
                    <div class="typo-body-small" style="margin-bottom: 2px;">üìû <%= organization.phone %></div>
                  <% end %>
                  <% if organization.email.present? %>
                    <div class="typo-body-small" style="color: #666; font-size: 0.75rem;">‚úâÔ∏è <%= organization.email %></div>
                  <% end %>
                  <% if organization.phone.blank? && organization.email.blank? %>
                    <span style="color: #999;">‚Äî</span>
                  <% end %>
                </div>
              </td>
              <td style="padding: var(--space-md);">
                <% if organization.active? %>
                  <span style="background-color: #d4edda; color: #155724; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                    ‚úì Actif
                  </span>
                <% else %>
                  <span style="background-color: #f8d7da; color: #721c24; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                    ‚úó Inactif
                  </span>
                <% end %>
              </td>
              <td style="padding: var(--space-md); text-align: center;">
                <div style="display: flex; gap: var(--space-sm); justify-content: center;">
                  <%= link_to organization_path(organization), class: "typo-btn-primary", style: "padding: 6px 12px; font-size: 0.75rem; white-space: nowrap;" do %>
                    Voir
                  <% end %>
                  <%= link_to edit_organization_path(organization), class: "typo-btn-secondary", style: "padding: 6px 12px; font-size: 0.75rem; white-space: nowrap;" do %>
                    √âditer
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <!-- Pagination -->
      <% if @organizations.total_pages > 1 %>
        <div style="margin-top: var(--space-xl);">
          <%= render 'shared/pagination', 
            current_page: @organizations.current_page, 
            total_pages: @organizations.total_pages, 
            total_count: @organizations.total_count, 
            per_page: 15,
            path: organizations_path %>
        </div>
      <% end %>
    <% else %>
      <div style="padding: var(--space-xl); text-align: center;">
        <div style="font-size: 3rem; margin-bottom: var(--space-md); opacity: 0.3;">üè¢</div>
        <h3 class="typo-h3" style="margin-bottom: var(--space-sm);">Aucune organisation trouv√©e</h3>
        <p class="typo-body" style="color: #666; margin-bottom: var(--space-lg);">
          <% if params[:search].present? || params[:organization_type].present? %>
            Aucun r√©sultat ne correspond √† vos crit√®res de recherche.
          <% else %>
            Commencez par cr√©er votre premi√®re organisation.
          <% end %>
        </p>
        <%= link_to new_organization_path, class: "typo-btn-success" do %>
          Cr√©er la premi√®re organisation
        <% end %>
      </div>
    <% end %>
  </div>
</div>
