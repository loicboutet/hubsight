<% content_for :header, @organization.name %>

<div class="section">
  <!-- Breadcrumb Navigation -->
  <div style="margin-bottom: var(--space-xl);">
    <%= render 'shared/breadcrumb', path: [
      { name: 'Organisations', url: organizations_path },
      { name: @organization.name, url: nil }
    ] %>
  </div>

  <!-- Header Section -->
  <div style="margin-bottom: var(--space-xl); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: var(--space-md);">
    <div style="display: flex; align-items: center; gap: var(--space-md); flex: 1; min-width: 300px;">
      <div style="font-size: 32px;">üè¢</div>
      <div>
        <h2 class="typo-h2" style="margin-bottom: var(--space-xs);"><%= @organization.name %></h2>
        <% if @organization.legal_name.present? %>
          <p class="typo-body-small" style="color: var(--medium-gray);"><%= @organization.legal_name %></p>
        <% end %>
      </div>
    </div>
    <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
      <%= link_to edit_organization_path(@organization), class: "typo-btn-small typo-btn-small-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        √âditer
      <% end %>
      
      <%= link_to organizations_path, class: "typo-btn-cancel" do %>
        ‚Üê Retour √† la liste
      <% end %>
      <button type="button"
        data-action="click->deletion-confirmation#openModal"
        data-modal-id="deletion-modal-org-<%= @organization.id %>"
        style="display: inline-flex; align-items: center; gap: 4px; padding: 6px 12px; background-color: #dc2626; color: white; border: none; border-radius: 6px; font-size: 0.813rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Supprimer
      </button>
    </div>
  </div>

  <!-- Status Badge -->
  <div style="margin-bottom: var(--space-xl);">
    <% if @organization.active? %>
      <span style="background-color: #d4edda; color: #155724; padding: 8px 16px; border-radius: 16px; font-size: 0.875rem; font-weight: 600;">
        ‚úì Organisation Active
      </span>
    <% else %>
      <span style="background-color: #f8d7da; color: #721c24; padding: 8px 16px; border-radius: 16px; font-size: 0.875rem; font-weight: 600;">
        ‚úó Organisation Inactive
      </span>
    <% end %>
  </div>

  <!-- Main Content -->
  <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
    <!-- Left Column -->
    <div>
      <!-- Basic Information -->
      <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
        <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
          üìã Informations de Base
        </h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Nom</label>
            <p class="typo-body"><%= @organization.name %></p>
          </div>
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Raison Sociale</label>
            <p class="typo-body"><%= @organization.legal_name.present? ? @organization.legal_name : "‚Äî" %></p>
          </div>
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">SIRET</label>
            <p class="typo-body"><%= @organization.formatted_siret || "‚Äî" %></p>
          </div>
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Type</label>
            <% if @organization.organization_type.present? %>
              <span style="background-color: var(--purple-pale); color: var(--purple-primary); padding: 4px 12px; border-radius: 12px; font-size: 0.875rem; font-weight: 600;">
                <%= @organization.type_label %>
              </span>
            <% else %>
              <p class="typo-body">‚Äî</p>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Contact Information -->
      <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
        <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
          üìû Coordonn√©es
        </h3>
        <div style="display: grid; gap: var(--space-md);">
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Adresse</label>
            <p class="typo-body"><%= @organization.headquarters_address.present? ? @organization.headquarters_address : "‚Äî" %></p>
          </div>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
            <div>
              <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">T√©l√©phone</label>
              <p class="typo-body">
                <% if @organization.phone.present? %>
                  <a href="tel:<%= @organization.phone %>" style="color: var(--purple-primary); text-decoration: none;">
                    üìû <%= @organization.phone %>
                  </a>
                <% else %>
                  ‚Äî
                <% end %>
              </p>
            </div>
            <div>
              <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Email</label>
              <p class="typo-body">
                <% if @organization.email.present? %>
                  <a href="mailto:<%= @organization.email %>" style="color: var(--purple-primary); text-decoration: none;">
                    ‚úâÔ∏è <%= @organization.email %>
                 </a>
                <% else %>
                  ‚Äî
                <% end %>
              </p>
            </div>
          </div>
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Site Web</label>
            <p class="typo-body">
              <% if @organization.website.present? %>
                <a href="<%= @organization.website %>" target="_blank" rel="noopener" style="color: var(--purple-primary); text-decoration: none;">
                  üåê <%= @organization.website %>
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="display: inline; vertical-align: middle; margin-left: 4px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              <% else %>
                ‚Äî
              <% end %>
            </p>
          </div>
        </div>
      </div>

      <!-- Business Information -->
      <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
        <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
          üíº Informations Commerciales
        </h3>
        <div style="display: grid; gap: var(--space-md);">
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Sp√©cialit√©s / M√©tiers</label>
            <p class="typo-body" style="white-space: pre-wrap;"><%= @organization.specialties.present? ? @organization.specialties : "‚Äî" %></p>
          </div>
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-xs); color: #666;">Date de D√©but de Relation</label>
            <p class="typo-body">
              <% if @organization.relationship_start_date.present? %>
                üìÖ <%= l(@organization.relationship_start_date, format: :long) %>
              <% else %>
                ‚Äî
              <% end %>
            </p>
          </div>
        </div>
      </div>

      <!-- Notes -->
      <% if @organization.notes.present? %>
        <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-lg);">
          <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
            üìù Notes
          </h3>
          <p class="typo-body" style="white-space: pre-wrap; color: #666;"><%= @organization.notes %></p>
        </div>
      <% end %>
    </div>

    <!-- Right Column - Quick Info & Stats -->
    <div>
      <!-- Quick Info Card -->
      <div style="background: linear-gradient(135deg, var(--purple-primary) 0%, var(--pink-primary) 100%); border-radius: var(--space-md); padding: var(--space-lg); color: white; margin-bottom: var(--space-lg);">
        <h4 class="typo-h4" style="margin-bottom: var(--space-md);">R√©sum√©</h4>
        <div style="display: grid; gap: var(--space-sm);">
          <div style="padding: var(--space-sm) 0; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <div class="typo-body-small" style="opacity: 0.9; margin-bottom: 4px;">Type</div>
            <div class="typo-body-small typo-bold"><%= @organization.type_label || "‚Äî" %></div>
          </div>
          <div style="padding: var(--space-sm) 0; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <div class="typo-body-small" style="opacity: 0.9; margin-bottom: 4px;">SIRET</div>
            <div class="typo-body-small typo-bold"><%= @organization.formatted_siret || "‚Äî" %></div>
          </div>
          <div style="padding: var(--space-sm) 0; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <div class="typo-body-small" style="opacity: 0.9; margin-bottom: 4px;">Statut</div>
            <div class="typo-body-small typo-bold"><%= @organization.active? ? "‚úì Actif" : "‚úó Inactif" %></div>
          </div>
          <% if @organization.relationship_start_date.present? %>
            <div style="padding: var(--space-sm) 0;">
              <div class="typo-body-small" style="opacity: 0.9; margin-bottom: 4px;">Relation depuis</div>
              <div class="typo-body-small typo-bold"><%= l(@organization.relationship_start_date, format: :long) %></div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Related Data -->
      <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-lg);">
        <h4 class="typo-h4" style="margin-bottom: var(--space-md);">Donn√©es Li√©es</h4>
        <div style="display: grid; gap: var(--space-sm);">
          <%= link_to contacts_path(organization_id: @organization.id), style: "padding: var(--space-sm); background-color: var(--pink-pale); border-radius: var(--space-sm); display: flex; justify-content: space-between; align-items: center; text-decoration: none; transition: background-color 0.2s;" do %>
            <span class="typo-body-small" style="color: var(--dark-gray);">Contacts</span>
            <span class="typo-body-small typo-bold" style="color: var(--purple-primary);"><%= @organization.contacts.count %></span>
          <% end %>
          <%= link_to agencies_path(organization_id: @organization.id), style: "padding: var(--space-sm); background-color: var(--pink-pale); border-radius: var(--space-sm); display: flex; justify-content: space-between; align-items: center; text-decoration: none; transition: background-color 0.2s;" do %>
            <span class="typo-body-small" style="color: var(--dark-gray);">Agences</span>
            <span class="typo-body-small typo-bold" style="color: var(--purple-primary);"><%= @organization.agencies.count %></span>
          <% end %>
          <div style="padding: var(--space-sm); background-color: var(--pink-pale); border-radius: var(--space-sm); display: flex; justify-content: space-between; align-items: center;">
            <span class="typo-body-small">Contrats</span>
            <span class="typo-body-small typo-bold" style="color: var(--purple-primary);">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Deletion Modal for Organization -->
<%
  active_contracts_count = @organization.contracts.where(status: 'active').count rescue 0
  total_contracts_count = @organization.contracts.count rescue 0
  sites_count = @organization.sites.count rescue 0
%>

<%= render 'shared/deletion_confirmation_modal',
  entity_type: "l'organisation",
  entity_name: @organization.name,
  entity_id: "org-#{@organization.id}",
  affected_items: {
    "contrats actifs" => active_contracts_count,
    "total contrats" => total_contracts_count,
    "sites" => sites_count
  },
  requires_extra_confirmation: (active_contracts_count > 0),
  delete_path: organization_path(@organization)
%>

<!-- Initialize deletion confirmation controller -->
<div data-controller="deletion-confirmation"></div>
