<% content_for :header, "Détails du Contrat" %>

<div class="section">
  <!-- Back button and header -->
  <div style="margin-bottom: var(--space-lg);">
    <%= link_to technician_contracts_path, class: "typo-btn-secondary", style: "display: inline-flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-md);" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Retour à la liste
    <% end %>
    
    <div class="page-header-responsive" style="margin-top: var(--space-md);">
      <div>
        <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-sm);">
          <h2 class="typo-h2" style="margin: 0;"><%= @contract.contract_number %></h2>
          <span style="display: inline-block; padding: 6px 12px; border-radius: 12px; font-size: 0.875rem; font-weight: 600; background-color: #d4edda; color: #155724;">
            <%= @contract.status == 'active' ? 'Actif' : 'Inactif' %>
          </span>
        </div>
        <p class="typo-h3" style="color: var(--coral-primary); margin-bottom: var(--space-xs);"><%= @contract.title %></p>
        <p class="typo-body-small" style="color: #666;"><%= @contract.contract_type %></p>
      </div>
      <div class="button-group-responsive">
        <a href="#" class="typo-btn-primary" style="display: inline-flex; align-items: center; gap: var(--space-sm);">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Télécharger PDF
        </a>
      </div>
    </div>
  </div>

  <!-- Contract Information Cards -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg);">
    
    <!-- Identification Card -->
    <div class="card">
      <div class="card-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3>Identification</h3>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="info-label">N° de contrat</span>
          <span class="info-value typo-bold"><%= @contract.contract_number %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Type de contrat</span>
          <span class="info-value"><%= @contract.contract_type %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Famille d'achats</span>
          <span class="info-value"><%= @contract.purchase_family %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Sous-famille</span>
          <span class="info-value"><%= @contract.purchase_subfamily %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Objet du contrat</span>
          <span class="info-value" style="font-size: 0.875rem; line-height: 1.5;"><%= @contract.object %></span>
        </div>
      </div>
    </div>

    <!-- Stakeholders Card -->
    <div class="card">
      <div class="card-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <h3>Intervenants</h3>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="info-label">Prestataire</span>
          <span class="info-value typo-bold"><%= @contract.contractor_organization %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Contact principal</span>
          <span class="info-value"><%= @contract.contractor_contact %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Email</span>
          <span class="info-value">
            <a href="mailto:<%= @contract.contractor_email %>" style="color: var(--coral-primary); text-decoration: none;">
              <%= @contract.contractor_email %>
            </a>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Téléphone</span>
          <span class="info-value">
            <a href="tel:<%= @contract.contractor_phone %>" style="color: var(--coral-primary); text-decoration: none;">
              <%= @contract.contractor_phone %>
            </a>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Gestionnaire contrat</span>
          <span class="info-value"><%= @contract.contract_manager %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Département</span>
          <span class="info-value"><%= @contract.managing_department %></span>
        </div>
      </div>
    </div>

    <!-- Scope Card -->
    <div class="card">
      <div class="card-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
        </svg>
        <h3>Périmètre</h3>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="info-label">Sites couverts</span>
          <span class="info-value"><%= @contract.covered_sites %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Bâtiments</span>
          <span class="info-value"><%= @contract.covered_buildings %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Type d'équipements</span>
          <span class="info-value"><%= @contract.equipment_type %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Nombre d'équipements</span>
          <span class="info-value typo-bold"><%= @contract.equipment_count %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Zones géographiques</span>
          <span class="info-value"><%= @contract.geographic_areas %></span>
        </div>
      </div>
    </div>

  </div>

  <!-- Financial Information -->
  <div class="card" style="margin-top: var(--space-lg);">
    <div class="card-header">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <h3>Aspects Financiers</h3>
    </div>
    <div class="card-content">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-lg);">
        <div class="info-row">
          <span class="info-label">Montant annuel HT</span>
          <span class="info-value typo-bold" style="color: var(--coral-primary); font-size: 1.25rem;">
            <%= number_to_currency(@contract.annual_amount_excl_tax, unit: "€", separator: " ", delimiter: " ", format: "%n %u") %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Montant annuel TTC</span>
          <span class="info-value typo-bold" style="color: var(--dark-gray); font-size: 1.25rem;">
            <%= number_to_currency(@contract.annual_amount_incl_tax, unit: "€", separator: " ", delimiter: " ", format: "%n %u") %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Mode de facturation</span>
          <span class="info-value"><%= @contract.billing_method %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Fréquence de facturation</span>
          <span class="info-value"><%= @contract.billing_frequency %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Indice de révision</span>
          <span class="info-value typo-bold"><%= @contract.revision_index %></span>
        </div>
        <div class="info-row" style="grid-column: 1 / -1;">
          <span class="info-label">Conditions de révision</span>
          <span class="info-value"><%= @contract.revision_conditions %></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Temporality -->
  <div class="card" style="margin-top: var(--space-lg);">
    <div class="card-header">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <h3>Temporalité</h3>
    </div>
    <div class="card-content">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-lg);">
        <div class="info-row">
          <span class="info-label">Date de signature</span>
          <span class="info-value"><%= @contract.signature_date.strftime("%d/%m/%Y") %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Date de début</span>
          <span class="info-value typo-bold" style="color: var(--coral-primary);">
            <%= @contract.start_date.strftime("%d/%m/%Y") %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Date de fin</span>
          <span class="info-value typo-bold" style="color: var(--coral-primary);">
            <%= @contract.end_date.strftime("%d/%m/%Y") %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Durée initiale</span>
          <span class="info-value"><%= @contract.initial_duration %> mois</span>
        </div>
        <div class="info-row">
          <span class="info-label">Durée de reconduction</span>
          <span class="info-value"><%= @contract.renewal_duration %> mois</span>
        </div>
        <div class="info-row">
          <span class="info-label">Nombre de reconductions</span>
          <span class="info-value"><%= @contract.renewal_count %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Reconduction automatique</span>
          <span class="info-value">
            <% if @contract.automatic_renewal %>
              <span style="color: #28a745; font-weight: 600;">✓ Oui</span>
            <% else %>
              <span style="color: #dc3545; font-weight: 600;">✗ Non</span>
            <% end %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Préavis de résiliation</span>
          <span class="info-value"><%= @contract.termination_notice %> jours</span>
        </div>
        <div class="info-row">
          <span class="info-label">Prochaine échéance</span>
          <span class="info-value typo-bold" style="color: #856404;">
            <%= @contract.next_deadline.strftime("%d/%m/%Y") %>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Services & SLA -->
  <div class="card" style="margin-top: var(--space-lg);">
    <div class="card-header">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
      </svg>
      <h3>Services & Niveaux de Service (SLA)</h3>
    </div>
    <div class="card-content">
      <div class="info-row" style="margin-bottom: var(--space-md);">
        <span class="info-label">Nature des services</span>
        <span class="info-value" style="line-height: 1.6;"><%= @contract.service_nature %></span>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-lg); margin-top: var(--space-md);">
        <div class="info-row">
          <span class="info-label">Fréquence d'intervention</span>
          <span class="info-value"><%= @contract.intervention_frequency %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Délai d'intervention</span>
          <span class="info-value typo-bold" style="color: var(--coral-primary);">
            <%= @contract.intervention_delay %>h
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Délai de résolution</span>
          <span class="info-value typo-bold" style="color: var(--coral-primary);">
            <%= @contract.resolution_delay %>h
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Horaires d'intervention</span>
          <span class="info-value"><%= @contract.working_hours %></span>
        </div>
        <div class="info-row">
          <span class="info-label">Astreinte 24/7</span>
          <span class="info-value">
            <% if @contract.on_call_24_7 %>
              <span style="color: #28a745; font-weight: 600;">✓ Oui</span>
            <% else %>
              <span style="color: #dc3545; font-weight: 600;">✗ Non</span>
            <% end %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Niveau de service garanti</span>
          <span class="info-value typo-bold" style="color: #28a745; font-size: 1.125rem;">
            <%= @contract.service_level %>%
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Pièces détachées incluses</span>
          <span class="info-value">
            <% if @contract.spare_parts_included %>
              <span style="color: #28a745; font-weight: 600;">✓ Oui</span>
            <% else %>
              <span style="color: #dc3545; font-weight: 600;">✗ Non</span>
            <% end %>
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Rapport d'intervention obligatoire</span>
          <span class="info-value">
            <% if @contract.intervention_report_required %>
              <span style="color: #28a745; font-weight: 600;">✓ Oui</span>
            <% else %>
              <span style="color: #dc3545; font-weight: 600;">✗ Non</span>
            <% end %>
          </span>
        </div>
      </div>

      <div class="info-row" style="margin-top: var(--space-lg); padding-top: var(--space-lg); border-top: 1px solid #eee;">
        <span class="info-label">Indicateurs de performance (KPI)</span>
        <span class="info-value" style="line-height: 1.6;"><%= @contract.kpi %></span>
      </div>
    </div>
  </div>

  <!-- Notes -->
  <% if @contract.notes.present? %>
    <div class="card" style="margin-top: var(--space-lg);">
      <div class="card-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        <h3>Notes & Remarques</h3>
      </div>
      <div class="card-content">
        <p class="info-value" style="line-height: 1.6; color: #666;"><%= @contract.notes %></p>
      </div>
    </div>
  <% end %>

  <!-- Back to list button -->
  <div style="margin-top: var(--space-xl); text-align: center;">
    <%= link_to technician_contracts_path, class: "typo-btn-secondary", style: "display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Retour à la liste des contrats
    <% end %>
  </div>
</div>
