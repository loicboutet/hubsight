<%
  # Deletion Confirmation Modal - Items 28-33
  # Reusable modal for confirming deletions with login validation
  # Params:
  #   entity_type: Type of entity being deleted (contract, equipment, site, etc.)
  #   entity_name: Name/identifier of the entity
  #   entity_id: ID for form submission
  #   affected_items: Hash of affected items, e.g., { contracts: 5, equipment: 12 }
  #   requires_extra_confirmation: Boolean for sites (shows checkbox)
  #   delete_path: Path for the delete action
  
  entity_type ||= "enregistrement"
  entity_name ||= ""
  entity_id ||= ""
  affected_items ||= {}
  requires_extra_confirmation ||= false
  delete_path ||= "#"
%>

<div id="deletion-modal-<%= entity_id %>" class="deletion-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
  <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
    <!-- Header -->
    <div style="padding: 24px 32px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 16px; background-color: #fef2f2;">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="#dc2626" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <div style="flex: 1;">
        <h3 style="margin: 0; color: #dc2626; font-size: 1.25rem; font-weight: 600;">Confirmer la suppression</h3>
        <p style="margin: 4px 0 0 0; color: #991b1b; font-size: 0.875rem;">Cette action est irréversible</p>
      </div>
      <button type="button" class="close-modal-btn" data-modal-id="deletion-modal-<%= entity_id %>" style="background: none; border: none; cursor: pointer; padding: 4px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#6b7280" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Body -->
    <div style="padding: 32px;">
      <!-- Entity Info -->
      <div style="margin-bottom: 24px;">
        <p style="margin: 0 0 8px 0; color: #374151; font-size: 1rem; font-weight: 500;">
          Vous êtes sur le point de supprimer <%= entity_type %> :
        </p>
        <p style="margin: 0; color: #dc2626; font-size: 1.125rem; font-weight: 600; padding: 12px; background-color: #fef2f2; border-radius: 6px;">
          <%= entity_name %>
        </p>
      </div>

      <!-- Affected Items Warning -->
      <% if affected_items.any? %>
        <div style="margin-bottom: 24px; padding: 16px; background-color: #fff3cd; border-left: 4px solid #fbbf24; border-radius: 6px;">
          <div style="display: flex; align-items: start; gap: 12px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="#d97706" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <div style="flex: 1;">
              <p style="margin: 0 0 8px 0; color: #92400e; font-weight: 600; font-size: 0.875rem;">
                Cette action affectera les éléments suivants :
              </p>
              <ul style="margin: 0; padding-left: 20px; color: #92400e; font-size: 0.875rem;">
                <% affected_items.each do |item_type, count| %>
                  <li style="margin-bottom: 4px;">
                    <strong><%= count %></strong> <%= item_type %>
                  </li>
                <% end %>
              </ul>
              <p style="margin: 12px 0 0 0; color: #92400e; font-size: 0.75rem; font-style: italic;">
                Note: Les comptages réels seront disponibles après l'implémentation backend
              </p>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Extra Confirmation for High-Impact Deletions -->
      <% if requires_extra_confirmation %>
        <div style="margin-bottom: 24px; padding: 16px; background-color: #fee2e2; border-left: 4px solid #dc2626; border-radius: 6px;">
          <p style="margin: 0 0 12px 0; color: #991b1b; font-weight: 600; font-size: 0.875rem;">
            ⚠️ Suppression en cascade activée
          </p>
          <p style="margin: 0 0 12px 0; color: #7f1d1d; font-size: 0.813rem;">
            La suppression de ce site entraînera la suppression automatique de tous les bâtiments, niveaux, espaces et équipements associés.
          </p>
          <label style="display: flex; align-items: start; gap: 8px; cursor: pointer; user-select: none;">
            <input 
              type="checkbox" 
              class="cascade-delete-checkbox" 
              data-modal-id="deletion-modal-<%= entity_id %>"
              style="margin-top: 4px; width: 16px; height: 16px; cursor: pointer;"
              required
            />
            <span style="color: #7f1d1d; font-size: 0.875rem;">
              Je comprends que cette action supprimera toutes les données associées de manière permanente
            </span>
          </label>
        </div>
      <% end %>

      <!-- Password Validation Section -->
      <div style="margin-bottom: 24px;">
        <label style="display: block; margin-bottom: 8px; color: #374151; font-weight: 600; font-size: 0.875rem;">
          Pour confirmer, veuillez saisir votre mot de passe :
        </label>
        <input 
          type="password" 
          class="deletion-password-input" 
          data-modal-id="deletion-modal-<%= entity_id %>"
          placeholder="Votre mot de passe"
          style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.938rem; transition: border-color 0.2s;"
          autocomplete="current-password"
        />
        <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 0.75rem;">
          La validation du mot de passe est effectuée de manière sécurisée côté backend
        </p>
        <div class="password-error-message" style="display: none; margin-top: 8px; padding: 8px 12px; background-color: #fee2e2; border-radius: 4px; color: #991b1b; font-size: 0.813rem;">
          Veuillez saisir votre mot de passe
        </div>
      </div>

    </div>

    <!-- Footer -->
    <div style="padding: 20px 32px; border-top: 1px solid #e5e7eb; background-color: #f9fafb; display: flex; justify-content: flex-end; gap: 12px; border-radius: 0 0 12px 12px;">
      <button 
        type="button" 
        class="close-modal-btn" 
        data-modal-id="deletion-modal-<%= entity_id %>"
        style="padding: 10px 24px; background-color: #e5e7eb; color: #374151; border: none; border-radius: 6px; font-weight: 600; font-size: 0.938rem; cursor: pointer; transition: background-color 0.2s;"
      >
        Annuler
      </button>
      <button 
        type="button" 
        class="confirm-delete-btn" 
        data-modal-id="deletion-modal-<%= entity_id %>"
        data-entity-type="<%= entity_type %>"
        data-entity-name="<%= entity_name %>"
        data-delete-path="<%= delete_path %>"
        disabled
        style="padding: 10px 24px; background-color: #dc2626; color: white; border: none; border-radius: 6px; font-weight: 600; font-size: 0.938rem; cursor: not-allowed; opacity: 0.5; transition: all 0.2s; display: flex; align-items: center; gap: 8px;"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Confirmer la suppression
      </button>
    </div>
  </div>
</div>

<style>
  /* Modal styles */
  .deletion-modal {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
  
  .deletion-password-input:focus {
    outline: none;
    border-color: #dc2626;
  }
  
  .confirm-delete-btn:not(:disabled) {
    cursor: pointer;
    opacity: 1;
  }
  
  .confirm-delete-btn:not(:disabled):hover {
    background-color: #b91c1c;
  }
  
  .close-modal-btn:hover {
    background-color: #d1d5db;
  }
  
  .cascade-delete-checkbox:focus {
    outline: 2px solid #dc2626;
    outline-offset: 2px;
  }
</style>
