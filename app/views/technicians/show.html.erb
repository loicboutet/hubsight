<% content_for :header, "Détails du Technicien" %>

<div class="section">
  <div style="margin-bottom: var(--space-xl); display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2 class="typo-h2" style="margin-bottom: var(--space-sm);"><%= @technician.full_name %></h2>
      <p class="typo-body-small">Informations détaillées du technicien</p>
    </div>
    <div style="display: flex; gap: var(--space-sm);">
      <%= link_to edit_technician_path(@technician), class: "typo-btn-primary", style: "display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        Modifier
      <% end %>
      <%= link_to technicians_path, class: "typo-btn-secondary", style: "display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Retour
      <% end %>
    </div>
  </div>

  <div class="grid" style="grid-template-columns: 2fr 1fr; gap: var(--space-lg);">
    <!-- Main Information Card -->
    <div class="card">
      <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">Informations Générales</h3>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Prénom</p>
          <p class="typo-body"><%= @technician.first_name %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Nom</p>
          <p class="typo-body"><%= @technician.last_name %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Email</p>
          <p class="typo-body"><%= @technician.email %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Téléphone</p>
          <p class="typo-body"><%= @technician.phone || '-' %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Département</p>
          <p class="typo-body"><%= @technician.department || '-' %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Statut</p>
          <% if @technician.active? %>
            <span style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 0.813rem; font-weight: 600; background-color: #d4edda; color: #155724;">
              Actif
            </span>
          <% else %>
            <span style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 0.813rem; font-weight: 600; background-color: #f8d7da; color: #721c24;">
              Inactif
            </span>
          <% end %>
        </div>
      </div>

      <% if @technician.invitation_pending? %>
        <div style="margin-top: var(--space-xl); padding: var(--space-md); background-color: #fff3cd; border-left: 4px solid #ffc107; border-radius: var(--space-sm);">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <p class="typo-body-small typo-bold" style="color: #856404; margin-bottom: var(--space-xs);">⚠️ Invitation en attente</p>
              <p class="typo-body-small" style="color: #856404;">
                Invitation envoyée le <%= l(@technician.invitation_sent_at, format: :long) %>
              </p>
            </div>
            <%= link_to "Renvoyer l'invitation", resend_invitation_technician_path(@technician), method: :post, class: "typo-btn-small", style: "background-color: #ffc107; color: #856404;" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Activity Card -->
    <div class="card">
      <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">Activité</h3>
      
      <div style="display: flex; flex-direction: column; gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Dernière connexion</p>
          <p class="typo-body">
            <% if @technician.current_sign_in_at %>
              <%= l(@technician.current_sign_in_at, format: :long) %>
            <% else %>
              Jamais connecté
            <% end %>
          </p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Nombre de connexions</p>
          <p class="typo-body"><%= @technician.sign_in_count || 0 %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Créé le</p>
          <p class="typo-body"><%= l(@technician.created_at, format: :long) %></p>
        </div>

        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-sm);">Créé par</p>
          <p class="typo-body"><%= @technician.invited_by&.full_name || 'N/A' %></p>
        </div>
      </div>

      <div style="margin-top: var(--space-xl); padding-top: var(--space-lg); border-top: 1px solid #e9ecef;">
        <%= link_to technician_path(@technician), method: :delete, data: { confirm: "Êtes-vous sûr de vouloir supprimer ce technicien ?" }, class: "typo-btn-danger", style: "width: 100%; display: inline-flex; align-items: center; justify-content: center; gap: var(--space-sm);" do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Supprimer le technicien
        <% end %>
      </div>
    </div>
  </div>
</div>
