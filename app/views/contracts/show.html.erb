<% content_for :header, @contract.title %>

<div class="section">
  <div style="margin-bottom: var(--space-xl); display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2 class="typo-h2" style="margin-bottom: var(--space-sm);"><%= @contract.title %></h2>
      <p class="typo-body-small">Contrat N¬∞ <%= @contract.contract_number %></p>
    </div>
    <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
      <%= link_to generate_pdf_contract_path(@contract.id), class: "typo-btn-small typo-btn-small-success", target: "_blank" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        G√©n√©rer Fiche PDF
      <% end %>
      <% if @contract.extraction_completed? %>
        <%= link_to validate_contract_path(@contract.id), class: "typo-btn-small typo-btn-small-success", style: "position: relative;" do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Voir Validation
        <% end %>
      <% else %>
        <button disabled class="typo-btn-small" style="background-color: #d1d5db; color: #6b7280; cursor: not-allowed; opacity: 0.6; position: relative;" title="L'extraction des donn√©es doit √™tre termin√©e avant la validation">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
          Voir Validation
          <span style="position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">üîí</span>
        </button>
      <% end %>
      <%= link_to audit_trail_path(entity_type: 'Contract', entity_id: @contract.id), class: "typo-btn-small typo-btn-small-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Historique
      <% end %>
      <%= link_to edit_contract_path(@contract.id), class: "typo-btn-small typo-btn-small-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        √âditer
      <% end %>
      <%= link_to contracts_path, class: "typo-btn-cancel" do %>
        Retour √† la liste
      <% end %>
    </div>
  </div>

  <div style="background-color: var(--white); border-radius: var(--space-md);">
    <!-- Contract Header Card -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: var(--space-xl); border-radius: var(--space-md); color: white; margin-bottom: var(--space-xl);">
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-lg);">
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">NUM√âRO</p>
          <p class="typo-h4" style="color: white;"><%= @contract.contract_number %></p>
        </div>
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">TYPE</p>
          <p class="typo-h4" style="color: white;"><%= @contract.contract_type %></p>
        </div>
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">MONTANT ANNUEL</p>
          <p class="typo-h4" style="color: white;"><%= number_to_currency(@contract.annual_amount_ht, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") %></p>
        </div>
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">STATUT</p>
          <p class="typo-h4" style="color: white;"><%= @contract.status.capitalize %></p>
        </div>
      </div>
    </div>

  <!-- Related Contracts Section (only for initial contracts) -->
  <% if false && (@amendments.any? || @framework_agreements.any?) %>
    <div style="background-color: var(--white); border-radius: var(--space-md); margin-bottom: var(--space-lg);">
      <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
        Contrats Associ√©s
      </h4>
      
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
        <!-- Amendments Column -->
        <div>
          <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">
            üìù Avenants (<%= @amendments.count %>)
          </h5>
          <% if @amendments.any? %>
            <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
              <% @amendments.each do |amendment| %>
                <div style="padding: var(--space-md); background-color: #f8f9fa; border-radius: var(--space-sm); border-left: 3px solid var(--coral-primary);">
                  <%= link_to contract_path(amendment.id), style: "text-decoration: none; color: inherit;" do %>
                    <p class="typo-body-small typo-bold" style="margin-bottom: var(--space-xs);"><%= amendment.contract_number %></p>
                    <p class="typo-body-small" style="margin-bottom: var(--space-xs);"><%= amendment.title %></p>
                    <p class="typo-body-small" style="color: var(--grey-primary);">
                      Sign√© le <%= amendment.signature_date.strftime("%d/%m/%Y") %>
                    </p>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="typo-body-small" style="color: var(--grey-primary);">Aucun avenant associ√©</p>
          <% end %>
        </div>

        <!-- Framework Agreements Column -->
        <div>
          <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">
            üìë Accords Cadres (<%= @framework_agreements.count %>)
          </h5>
          <% if @framework_agreements.any? %>
            <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
              <% @framework_agreements.each do |framework| %>
                <div style="padding: var(--space-md); background-color: #f8f9fa; border-radius: var(--space-sm); border-left: 3px solid #667eea;">
                  <%= link_to contract_path(framework.id), style: "text-decoration: none; color: inherit;" do %>
                    <p class="typo-body-small typo-bold" style="margin-bottom: var(--space-xs);"><%= framework.contract_number %></p>
                    <p class="typo-body-small" style="margin-bottom: var(--space-xs);"><%= framework.title %></p>
                    <p class="typo-body-small" style="color: var(--grey-primary);">
                      Sign√© le <%= framework.signature_date.strftime("%d/%m/%Y") %>
                    </p>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="typo-body-small" style="color: var(--grey-primary);">Aucun accord cadre associ√©</p>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Item 11: Property Deed-Specific Display Section -->
  <% if @contract.contract_type == 'property_deed' %>
    <div style="background-color: var(--white); border-radius: var(--space-md); margin-bottom: var(--space-lg); padding: var(--space-lg); background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
      <h4 class="typo-h3" style="margin-bottom: var(--space-lg); color: white;">
        üè¢ Informations Sp√©cifiques √† l'Acte de Propri√©t√©
      </h4>
      
      <div style="background-color: rgba(255,255,255,0.95); padding: var(--space-lg); border-radius: var(--space-sm);">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Site</p>
            <p class="typo-body typo-bold"><%= @contract.property_deed_site %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date d'Acquisition</p>
            <p class="typo-body typo-bold"><%= @contract.property_deed_acquisition_date %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Surface (m¬≤)</p>
            <p class="typo-body typo-bold" style="color: #059669; font-size: 1.25rem;"><%= number_with_delimiter(@contract.property_deed_area, delimiter: ' ') %> m¬≤</p>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type d'Usage</p>
            <p class="typo-body"><%= @contract.property_deed_usage_type %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type de Propri√©t√©</p>
            <p class="typo-body"><%= @contract.property_deed_type %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Prix d'Acquisition (‚Ç¨)</p>
            <p class="typo-body typo-bold" style="color: #059669; font-size: 1.25rem;"><%= number_to_currency(@contract.property_deed_acquisition_price, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") %></p>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Valeur V√©nale Actuelle (‚Ç¨)</p>
            <p class="typo-body typo-bold" style="color: #059669; font-size: 1.25rem;"><%= number_to_currency(@contract.property_deed_current_value, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Derni√®re MAJ Valeur V√©nale</p>
            <p class="typo-body"><%= @contract.property_deed_value_update_date %></p>
          </div>
          <div style="background-color: #fff3cd; padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #f59e0b;">
            <p class="typo-body-small typo-bold" style="color: #856404; margin-bottom: var(--space-xs);">‚ö†Ô∏è Alertes</p>
            <p class="typo-body-small" style="color: #856404;"><%= @contract.property_deed_alerts %></p>
          </div>
        </div>

        <% if @contract.property_deed_current_value.present? && @contract.property_deed_acquisition_price.present? %>
          <% 
            gain = @contract.property_deed_current_value - @contract.property_deed_acquisition_price
            gain_percent = ((gain / @contract.property_deed_acquisition_price) * 100).round(2)
          %>
          <div style="background-color: #ecfdf5; padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #10b981; margin-top: var(--space-lg);">
            <p class="typo-body-small typo-bold" style="color: #065f46; margin-bottom: var(--space-xs);">üìä Plus-Value Potentielle</p>
            <p class="typo-body" style="color: #065f46;">+ <%= number_to_currency(gain, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") %> (+<%= gain_percent %>%) depuis l'acquisition</p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Item 7: Lease-Specific Display Section -->
  <% if @contract.contract_type == 'lease' %>
    <div style="background-color: var(--white); border-radius: var(--space-md); margin-bottom: var(--space-lg); padding: var(--space-lg); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <h4 class="typo-h3" style="margin-bottom: var(--space-lg); color: white;">
        üìã Informations Sp√©cifiques au Bail
      </h4>
      
      <div style="background-color: rgba(255,255,255,0.95); padding: var(--space-lg); border-radius: var(--space-sm);">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Site</p>
            <p class="typo-body typo-bold"><%= @contract.covered_sites || '-' %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Propri√©taire (Organisation)</p>
            <p class="typo-body typo-bold"><%= @contract.contractor_organization_name || '-' %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type de Bail</p>
            <p class="typo-body"><%= @contract.lease_type&.capitalize || '-' %></p>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Surface (m¬≤)</p>
            <p class="typo-body typo-bold" style="color: var(--coral-primary); font-size: 1.25rem;"><%= @contract.lease_area || '-' %> m¬≤</p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Loyer Mensuel HT (‚Ç¨)</p>
            <p class="typo-body typo-bold" style="color: var(--coral-primary); font-size: 1.25rem;">
              <%= number_to_currency(@contract.monthly_rent_excl_tax, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") if @contract.monthly_rent_excl_tax %>
            </p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Charges Mensuelles (‚Ç¨)</p>
            <p class="typo-body typo-bold" style="font-size: 1.25rem;">
              <%= number_to_currency(@contract.monthly_charges, unit: "‚Ç¨", separator: ",", delimiter: " ", format: "%n %u") if @contract.monthly_charges %>
            </p>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type d'Indexation</p>
            <p class="typo-body"><%= @contract.indexation_type || '-' %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Taux d'Indexation (%)</p>
            <p class="typo-body"><%= @contract.indexation_rate || '-' %>%</p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de Signature</p>
            <p class="typo-body"><%= @contract.signature_date&.strftime("%d/%m/%Y") || '-' %></p>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de Prise d'Effet</p>
            <p class="typo-body"><%= @contract.lease_effective_date&.strftime("%d/%m/%Y") || @contract.effective_date&.strftime("%d/%m/%Y") || '-' %></p>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Dur√©e du Bail (mois)</p>
            <p class="typo-body"><%= @contract.lease_duration_months || '-' %> mois</p>
          </div>
          <div style="background-color: #fff3cd; padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #ffc107;">
            <p class="typo-body-small typo-bold" style="color: #856404; margin-bottom: var(--space-xs);">‚è∞ Prochaine √âch√©ance de Bail</p>
            <p class="typo-body typo-bold" style="color: #856404; font-size: 1.125rem;"><%= @contract.next_lease_deadline&.strftime("%d/%m/%Y") || '-' %></p>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Statut</p>
            <span class="<%= @contract.status == 'active' ? 'typo-badge-success' : 'typo-badge-warning' %>">
              <%= @contract.status %>
            </span>
          </div>
          <div>
            <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Alertes / Notifications</p>
            <% if @contract.lease_alerts.present? %>
              <div style="display: flex; flex-wrap: wrap; gap: var(--space-sm);">
                <% @contract.lease_alerts.split(',').each do |alert| %>
                  <span style="display: inline-flex; align-items: center; gap: 4px; padding: 6px 12px; background-color: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.875rem; font-weight: 600;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <%= alert.strip %>
                  </span>
                <% end %>
              </div>
            <% else %>
              <p class="typo-body-small" style="color: #999;">Aucune alerte</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Identification Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Identification du Contrat
    </h4>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Num√©ro de Contrat</p>
        <p class="typo-body"><%= @contract.contract_number %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">R√©f√©rence Publique</p>
        <p class="typo-body"><%= @contract.public_reference || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type de Contrat</p>
        <p class="typo-body"><%= @contract.contract_type %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">√âtat du Contrat</p>
        <span class="<%= @contract.status == 'active' ? 'typo-badge-success' : 'typo-badge-warning' %>">
          <%= @contract.status %>
        </span>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Famille d'Achats</p>
        <p class="typo-body"><%= @contract.contract_family %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Sous-Famille d'Achats</p>
        <p class="typo-body"><%= @contract.purchase_subfamily || '-' %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Objet du Contrat</p>
        <p class="typo-body"><%= @contract.contract_object %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nature des Prestations</p>
        <p class="typo-body"><%= @contract.service_nature || '-' %></p>
      </div>
    </div>
  </div>

  <!-- Stakeholders Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Parties Prenantes
    </h4>
    
    <!-- Client Organization -->
    <div style="margin-bottom: var(--space-lg);">
      <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">Organisation Cliente</h5>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nom de l'Organisation</p>
          <p class="typo-body typo-bold"><%= @contract.client_organization_name || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Contact Principal</p>
          <p class="typo-body"><%= @contract.client_contact_name || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Email Contact</p>
          <p class="typo-body"><%= @contract.client_contact_email || '-' %></p>
        </div>
      </div>
    </div>

    <!-- Supplier Organization -->
    <div style="margin-bottom: var(--space-lg);">
      <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">Organisation Prestataire</h5>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nom de l'Organisation</p>
          <p class="typo-body typo-bold"><%= @contract.contractor_organization_name || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Agence</p>
          <p class="typo-body"><%= @contract.contractor_agency_name || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Contact Principal</p>
          <p class="typo-body"><%= @contract.contractor_contact_name || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Email</p>
          <p class="typo-body"><%= @contract.contractor_email || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">T√©l√©phone</p>
          <p class="typo-body"><%= @contract.contractor_phone || '-' %></p>
        </div>
      </div>
    </div>

    <!-- Contract Management -->
    <div>
      <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">Gestion du Contrat</h5>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Gestionnaire du Contrat</p>
          <p class="typo-body"><%= @contract.monitoring_manager || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">D√©partement Gestionnaire</p>
          <p class="typo-body"><%= @contract.managing_department || '-' %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Financial Section - Full Width -->
  <div style="background-color: var(--white); border-radius: var(--space-md); margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Aspects Financiers
    </h4>
    
    <!-- Amounts Sub-section -->
    <div style="margin-bottom: var(--space-lg);">
      <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">Montants</h5>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Initial Annualis√© HT</p>
          <p class="typo-body"><%= number_to_currency(@contract.annual_amount_ht, unit: "EUR", separator: ",", delimiter: " ", format: "%n %u") %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Annualis√© HT (Auto-calc)</p>
          <p class="typo-body typo-bold" style="color: var(--coral-primary);"><%= number_to_currency(@contract.annual_amount_ht, unit: "EUR", separator: ",", delimiter: " ", format: "%n %u") %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Estimatif Annualis√© HT</p>
          <p class="typo-body"><%= number_to_currency(@contract.annual_amount_ht, unit: "EUR", separator: ",", delimiter: " ", format: "%n %u") if @contract.annual_amount_ht %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Annualis√© TTC (Manuel)</p>
          <p class="typo-body"><%= number_to_currency(@contract.annual_amount_ttc, unit: "EUR", separator: ",", delimiter: " ", format: "%n %u") if @contract.annual_amount_ttc %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Annualis√© TTC (Auto-calc)</p>
          <p class="typo-body"><%= number_to_currency(@contract.annual_amount_ttc, unit: "EUR", separator: ",", delimiter: " ", format: "%n %u") if @contract.annual_amount_ttc %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Taux de TVA</p>
          <p class="typo-body"><%= @contract.vat_rate || '-' %>%</p>
        </div>
      </div>
    </div>

    <!-- Price Revision Sub-section -->
    <div style="margin-bottom: var(--space-lg);">
      <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">R√©vision des Prix</h5>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Indice de R√©vision</p>
          <p class="typo-body"><%= @contract.revision_index || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Fr√©quence de R√©vision</p>
          <p class="typo-body"><%= @contract.revision_frequency || '-' %></p>
        </div>
        <div  style="grid-column: 1 / -1;">
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Conditions de R√©vision</p>
          <p class="typo-body"><%= @contract.revision_conditions || '-' %></p>
        </div>
      </div>
    </div>

    <!-- Payment & Billing Sub-section -->
    <div>
      <h5 class="typo-body typo-bold" style="color: var(--coral-primary); margin-bottom: var(--space-md); font-size: 1rem;">Facturation et R√®glement</h5>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Fr√©quence de Facturation</p>
          <p class="typo-body"><%= @contract.billing_frequency || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Mode de R√®glement</p>
          <p class="typo-body"><%= @contract.billing_method || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Conditions de Paiement</p>
          <p class="typo-body"><%= @contract.payment_terms || '-' %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Scope Section - Full Width -->
  <div style="background-color: var(--white); border-radius: var(--space-md); margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      P√©rim√®tre
    </h4>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Sites Couverts</p>
        <p class="typo-body"><%= Array(@contract.covered_sites).join(', ') if @contract.covered_sites.present? || '-' %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">B√¢timents Couverts</p>
        <p class="typo-body"><%= Array(@contract.covered_buildings).join(', ') if @contract.covered_buildings.present? || '-' %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Types d'√âquipement Couverts</p>
        <p class="typo-body"><%= Array(@contract.covered_equipment_types).join(', ') if @contract.covered_equipment_types.present? || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nombre d'√âquipements</p>
        <p class="typo-body"><%= @contract.equipment_count || '-' %></p>
      </div>
    </div>
  </div>

  <!-- Temporality Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Temporalit√©
    </h4>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de Signature</p>
        <p class="typo-body"><%= @contract.signature_date&.strftime("%d/%m/%Y") if @contract.signature_date || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de D√©but</p>
        <p class="typo-body"><%= @contract.start_date&.strftime("%d/%m/%Y") if @contract.start_date || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de Fin</p>
        <p class="typo-body"><%= @contract.end_date&.strftime("%d/%m/%Y") if @contract.end_date || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Dur√©e Initiale (mois)</p>
        <p class="typo-body"><%= @contract.initial_duration_months || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Dur√©e Renouvellement (mois)</p>
        <p class="typo-body"><%= @contract.renewal_duration_months || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nombre de Renouvellements</p>
        <p class="typo-body"><%= @contract.renewal_count || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Reconduction Automatique</p>
        <p class="typo-body"><%= @contract.automatic_renewal ? 'Oui' : 'Non' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">D√©lai de Pr√©avis (jours)</p>
        <p class="typo-body"><%= @contract.notice_period_days || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Prochaine √âch√©ance</p>
        <p class="typo-body typo-bold" style="color: var(--coral-primary);"><%= @contract.next_deadline_date&.strftime("%d/%m/%Y") if @contract.next_deadline_date || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Dernier Renouvellement</p>
        <p class="typo-body"><%= @contract.last_renewal_date&.strftime("%d/%m/%Y") if @contract.last_renewal_date || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de R√©siliation</p>
        <p class="typo-body"><%= @contract.termination_date&.strftime("%d/%m/%Y") if @contract.termination_date || '-' %></p>
      </div>
    </div>
  </div>

  <!-- Services & SLA Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Services et Niveau de Service
    </h4>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nature des Prestations</p>
        <p class="typo-body"><%= @contract.service_nature || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Fr√©quence d'Intervention</p>
        <p class="typo-body"><%= @contract.intervention_frequency || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">D√©lai d'Intervention (heures)</p>
        <p class="typo-body"><%= @contract.intervention_delay_hours || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">D√©lai de R√©solution (heures)</p>
        <p class="typo-body"><%= @contract.resolution_delay_hours || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Horaires de Travail</p>
        <p class="typo-body"><%= @contract.working_hours || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Service 24/7</p>
        <p class="typo-body"><%= @contract.on_call_24_7 ? 'Oui' : 'Non' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Niveau de Service (SLA %)</p>
        <p class="typo-body"><%= @contract.sla_percentage || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Pi√®ces de Rechange</p>
        <p class="typo-body"><%= @contract.spare_parts_included ? 'Incluses' : 'Non incluses' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Rapport d'Intervention</p>
        <p class="typo-body"><%= @contract.report_required ? 'Obligatoire' : 'Non obligatoire' %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Indicateurs de Performance (KPI)</p>
        <p class="typo-body"><%= Array(@contract.kpis).join(', ') if @contract.kpis.present? || '-' %></p>
      </div>
    </div>
  </div>

  <!-- OCR Extraction Section -->
  <%= render 'ocr_section' %>

  <!-- LLM Extracted Data Section -->
  <%= render 'extracted_data' %>
</div>
