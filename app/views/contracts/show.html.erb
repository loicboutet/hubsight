<% content_for :header, @contract.title %>

<div class="section">
  <div style="margin-bottom: var(--space-xl); display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2 class="typo-h2" style="margin-bottom: var(--space-sm);"><%= @contract.title %></h2>
      <p class="typo-body-small">Contrat N° <%= @contract.contract_number %></p>
    </div>
    <div style="display: flex; gap: var(--space-md);">
      <%= link_to edit_contract_path(@contract.id), class: "typo-btn-small typo-btn-small-primary" do %>
        <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
        Éditer
      <% end %>
      <%= link_to contracts_path, class: "typo-btn-cancel" do %>
        Retour à la liste
      <% end %>
    </div>
  </div>

  <div style="background-color: var(--white); border-radius: var(--space-md);">
    <!-- Contract Header Card -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: var(--space-xl); border-radius: var(--space-md); color: white; margin-bottom: var(--space-xl);">
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-lg);">
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">NUMÉRO</p>
          <p class="typo-h4" style="color: white;"><%= @contract.contract_number %></p>
        </div>
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">TYPE</p>
          <p class="typo-h4" style="color: white;"><%= @contract.contract_type %></p>
        </div>
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">MONTANT ANNUEL</p>
          <p class="typo-h4" style="color: white;"><%= number_to_currency(@contract.annual_amount_excl_tax, unit: "€", separator: ",", delimiter: " ", format: "%n %u") %></p>
        </div>
        <div>
          <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-bottom: var(--space-xs);">STATUT</p>
          <p class="typo-h4" style="color: white;"><%= @contract.status.capitalize %></p>
        </div>
      </div>
    </div>

  <!-- Identification Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Identification du Contrat
    </h4>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Numéro de Contrat</p>
        <p class="typo-body"><%= @contract.contract_number %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type de Contrat</p>
        <p class="typo-body"><%= @contract.contract_type %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Statut</p>
        <span class="<%= @contract.status == 'active' ? 'typo-badge-success' : 'typo-badge-warning' %>">
          <%= @contract.status %>
        </span>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Famille d'Achats</p>
        <p class="typo-body"><%= @contract.purchase_family %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Sous-Famille</p>
        <p class="typo-body"><%= @contract.purchase_subfamily || '-' %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Objet du Contrat</p>
        <p class="typo-body"><%= @contract.object %></p>
      </div>
    </div>
  </div>

  <!-- Stakeholders Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Parties Prenantes
    </h4>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Prestataire</p>
        <p class="typo-body typo-bold"><%= @contract.contractor_organization %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Contact Principal</p>
        <p class="typo-body"><%= @contract.contractor_contact || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Email</p>
        <p class="typo-body"><%= @contract.contractor_email || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Téléphone</p>
        <p class="typo-body"><%= @contract.contractor_phone || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Gestionnaire du Contrat</p>
        <p class="typo-body"><%= @contract.contract_manager || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Département Gestionnaire</p>
        <p class="typo-body"><%= @contract.managing_department || '-' %></p>
      </div>
    </div>
  </div>

  <!-- Scope and Financial Sections in Grid -->
  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg); margin-bottom: var(--space-lg);">
    <!-- Scope Section -->
    <div style="background-color: var(--white); border-radius: var(--space-md); ">
      <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
        Périmètre
      </h4>
      <div style="display: flex; flex-direction: column; gap: var(--space-md);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Sites Couverts</p>
          <p class="typo-body"><%= @contract.covered_sites || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Bâtiments</p>
          <p class="typo-body"><%= @contract.covered_buildings || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Type d'Équipement</p>
          <p class="typo-body"><%= @contract.equipment_type || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nombre d'Équipements</p>
          <p class="typo-body"><%= @contract.equipment_count || '-' %></p>
        </div>
      </div>
    </div>

    <!-- Financial Section -->
    <div style="background-color: var(--white); border-radius: var(--space-md); ">
      <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
        Aspects Financiers
      </h4>
      <div style="display: flex; flex-direction: column; gap: var(--space-md);">
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Annuel HT</p>
          <p class="typo-body typo-bold" style="color: var(--coral-primary);"><%= number_to_currency(@contract.annual_amount_excl_tax, unit: "€", separator: ",", delimiter: " ", format: "%n %u") %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Montant Annuel TTC</p>
          <p class="typo-body"><%= number_to_currency(@contract.annual_amount_incl_tax, unit: "€", separator: ",", delimiter: " ", format: "%n %u") if @contract.annual_amount_incl_tax %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Mode de Facturation</p>
          <p class="typo-body"><%= @contract.billing_method %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Fréquence</p>
          <p class="typo-body"><%= @contract.billing_frequency || '-' %></p>
        </div>
        <div>
          <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Indice de Révision</p>
          <p class="typo-body"><%= @contract.revision_index || '-' %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Temporality Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Temporalité
    </h4>
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-lg);">
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de Signature</p>
        <p class="typo-body"><%= @contract.signature_date.strftime("%d/%m/%Y") if @contract.signature_date %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Début d'Exécution</p>
        <p class="typo-body"><%= @contract.start_date.strftime("%d/%m/%Y") if @contract.start_date %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Date de Fin</p>
        <p class="typo-body"><%= @contract.end_date.strftime("%d/%m/%Y") if @contract.end_date %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Durée Initiale</p>
        <p class="typo-body"><%= @contract.initial_duration %> mois</p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Durée de Reconduction</p>
        <p class="typo-body"><%= @contract.renewal_duration || '-' %> <%= 'mois' if @contract.renewal_duration %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nb. Reconductions</p>
        <p class="typo-body"><%= @contract.renewal_count || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Reconduction Auto.</p>
        <p class="typo-body"><%= @contract.automatic_renewal ? 'Oui' : 'Non' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Préavis</p>
        <p class="typo-body"><%= @contract.termination_notice || '-' %> <%= 'jours' if @contract.termination_notice %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Prochaine Échéance</p>
        <p class="typo-body typo-bold" style="color: var(--coral-primary);"><%= @contract.next_deadline.strftime("%d/%m/%Y") if @contract.next_deadline %></p>
      </div>
    </div>
  </div>

  <!-- Services & SLA Section -->
  <div style="background-color: var(--white); border-radius: var(--space-md);  margin-bottom: var(--space-lg);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
      Services et Niveau de Service
    </h4>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Nature des Prestations</p>
        <p class="typo-body"><%= @contract.service_nature || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Fréquence d'Intervention</p>
        <p class="typo-body"><%= @contract.intervention_frequency || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Délai d'Intervention</p>
        <p class="typo-body"><%= @contract.intervention_delay || '-' %> <%= 'heures' if @contract.intervention_delay %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Délai de Résolution</p>
        <p class="typo-body"><%= @contract.resolution_delay || '-' %> <%= 'heures' if @contract.resolution_delay %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Horaires d'Intervention</p>
        <p class="typo-body"><%= @contract.working_hours || '-' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Astreinte 24/7</p>
        <p class="typo-body"><%= @contract.on_call_24_7 ? 'Oui' : 'Non' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Niveau de Service</p>
        <p class="typo-body"><%= @contract.service_level || '-' %> <%= '%' if @contract.service_level %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Pièces de Rechange</p>
        <p class="typo-body"><%= @contract.spare_parts_included ? 'Incluses' : 'Non incluses' %></p>
      </div>
      <div>
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">Rapport d'Intervention</p>
        <p class="typo-body"><%= @contract.intervention_report_required ? 'Obligatoire' : 'Non obligatoire' %></p>
      </div>
      <div style="grid-column: 1 / -1;">
        <p class="typo-body-small typo-bold" style="color: var(--gray-secondary); margin-bottom: var(--space-xs);">KPI</p>
        <p class="typo-body"><%= @contract.kpi || '-' %></p>
      </div>
    </div>
  </div>

  <!-- Notes Section -->
  <% if @contract.notes.present? %>
    <div style="background-color: var(--white); border-radius: var(--space-md); ">
      <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
        Notes et Observations
      </h4>
      <p class="typo-body"><%= @contract.notes %></p>
    </div>
  <% end %>
</div>
