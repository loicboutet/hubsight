<% content_for :header, "Économies Potentielles" %>

<div class="section">
  <!-- Header Section -->
  <div style="margin-bottom: var(--space-xl); display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2 class="typo-h2" style="margin-bottom: var(--space-sm);">Analyse des Économies Potentielles</h2>
      <p class="typo-body-small">Identifiez les opportunités d'optimisation pour vos sites</p>
    </div>
    <div style="display: flex; gap: var(--space-md);">
      <select style="padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);">
        <option>Tous les sites</option>
        <option>Tour Montparnasse</option>
        <option>Campus La Défense</option>
      </select>
      <select style="padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);">
        <option>12 derniers mois</option>
        <option>6 derniers mois</option>
        <option>3 derniers mois</option>
      </select>
    </div>
  </div>

  <!-- Summary Cards -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md); margin-bottom: var(--space-xl);">
    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.05) 0%, rgba(34, 197, 94, 0.1) 100%); padding: var(--space-lg); border-radius: var(--space-md); border-left: 4px solid #22c55e; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-md);">
        <div>
          <p style="color: var(--medium-gray); font-size: 0.75rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">Économies Potentielles Totales</p>
          <p style="color: #22c55e; font-size: 2rem; font-weight: 700; margin: 0;">127 500 €</p>
          <p style="color: var(--medium-gray); font-size: 0.875rem; margin-top: 4px;">Sur 12 mois</p>
        </div>
        <div style="background-color: rgba(34, 197, 94, 0.15); padding: var(--space-sm); border-radius: 50%;">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="#22c55e" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
          </svg>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-xs);">
        <span style="color: #22c55e; font-weight: 600; font-size: 0.875rem;">↑ 18.5%</span>
        <span style="color: var(--medium-gray); font-size: 0.875rem;">vs année précédente</span>
      </div>
    </div>

    <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.1) 100%); padding: var(--space-lg); border-radius: var(--space-md); border-left: 4px solid #3b82f6; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-md);">
        <div>
          <p style="color: var(--medium-gray); font-size: 0.75rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">Opportunités Identifiées</p>
          <p style="color: #3b82f6; font-size: 2rem; font-weight: 700; margin: 0;">24</p>
          <p style="color: var(--medium-gray); font-size: 0.875rem; margin-top: 4px;">Actions recommandées</p>
        </div>
        <div style="background-color: rgba(59, 130, 246, 0.15); padding: var(--space-sm); border-radius: 50%;">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="#3b82f6" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-xs);">
        <span style="color: #3b82f6; font-weight: 600; font-size: 0.875rem;">12 prioritaires</span>
        <span style="color: var(--medium-gray); font-size: 0.875rem;">à mettre en œuvre</span>
      </div>
    </div>

    <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(245, 158, 11, 0.1) 100%); padding: var(--space-lg); border-radius: var(--space-md); border-left: 4px solid #f59e0b; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-md);">
        <div>
          <p style="color: var(--medium-gray); font-size: 0.75rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">ROI Moyen</p>
          <p style="color: #f59e0b; font-size: 2rem; font-weight: 700; margin: 0;">8.2 mois</p>
          <p style="color: var(--medium-gray); font-size: 0.875rem; margin-top: 4px;">Retour sur investissement</p>
        </div>
        <div style="background-color: rgba(245, 158, 11, 0.15); padding: var(--space-sm); border-radius: 50%;">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="#f59e0b" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-xs);">
        <span style="color: #22c55e; font-weight: 600; font-size: 0.875rem;">Excellent</span>
        <span style="color: var(--medium-gray); font-size: 0.875rem;">délai de récupération</span>
      </div>
    </div>

    <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(168, 85, 247, 0.1) 100%); padding: var(--space-lg); border-radius: var(--space-md); border-left: 4px solid #a855f7; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-md);">
        <div>
          <p style="color: var(--medium-gray); font-size: 0.75rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">Économies Réalisées</p>
          <p style="color: #a855f7; font-size: 2rem; font-weight: 700; margin: 0;">42 300 €</p>
          <p style="color: var(--medium-gray); font-size: 0.875rem; margin-top: 4px;">Cette année</p>
        </div>
        <div style="background-color: rgba(168, 85, 247, 0.15); padding: var(--space-sm); border-radius: 50%;">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="#a855f7" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
          </svg>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-xs);">
        <span style="color: #a855f7; font-weight: 600; font-size: 0.875rem;">33% de l'objectif</span>
        <span style="color: var(--medium-gray); font-size: 0.875rem;">atteint</span>
      </div>
    </div>
  </div>

  <!-- Savings by Category -->
  <div style="margin-bottom: var(--space-xl);">
    <h4 class="typo-h4" style="margin-bottom: var(--space-lg);">Économies par Catégorie</h4>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-md);">
      <%
        categories = [
          { name: 'Énergie', amount: 45800, percentage: 36, color: '#22c55e', opportunities: 8 },
          { name: 'Maintenance', amount: 38200, percentage: 30, color: '#3b82f6', opportunities: 9 },
          { name: 'Contrats', amount: 28500, percentage: 22, color: '#f59e0b', opportunities: 5 },
          { name: 'Équipements', amount: 15000, percentage: 12, color: '#a855f7', opportunities: 2 }
        ]
      %>

      <% categories.each do |category| %>
        <div style="background-color: var(--white); padding: var(--space-lg); border-radius: var(--space-md); border: 1px solid var(--light-gray); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-md);">
            <div>
              <h5 class="typo-h5" style="color: var(--dark-gray); margin-bottom: var(--space-xs);"><%= category[:name] %></h5>
              <p style="color: <%= category[:color] %>; font-size: 1.75rem; font-weight: 700; margin: 0;"><%= number_to_currency(category[:amount], unit: '', precision: 0, delimiter: ' ') %> €</p>
            </div>
            <div style="background-color: <%= category[:color] %>15; padding: var(--space-sm); border-radius: 50%;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="<%= category[:color] %>" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <div style="margin-bottom: var(--space-md);">
            <div style="background-color: #f3f4f6; height: 8px; border-radius: 4px; overflow: hidden;">
              <div style="background-color: <%= category[:color] %>; height: 100%; width: <%= category[:percentage] %>%; transition: width 0.3s ease;"></div>
            </div>
            <p style="color: var(--medium-gray); font-size: 0.875rem; margin-top: var(--space-xs);"><%= category[:percentage] %>% du total</p>
          </div>
          <div style="display: flex; align-items: center; gap: var(--space-xs);">
            <span style="display: inline-block; padding: 4px 10px; background-color: <%= category[:color] %>15; color: <%= category[:color] %>; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
              <%= category[:opportunities] %> opportunités
            </span>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Savings Opportunities List -->
  <div style="margin-bottom: var(--space-xl);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
      <h4 class="typo-h4">Opportunités d'Économies Prioritaires</h4>
      <div style="display: flex; gap: var(--space-sm);">
        <button type="button" class="typo-btn-small typo-btn-small-secondary">
          Exporter PDF
        </button>
      </div>
    </div>

    <div style="background-color: var(--white); border-radius: var(--space-md);">
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="border-bottom: 2px solid var(--pink-pale);">
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Priorité</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Opportunité</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Site</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Catégorie</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Économie Annuelle</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Investissement</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">ROI</th>
            <th class="typo-body-small typo-bold" style="text-align: left; padding: var(--space-md); color: #666;">Statut</th>
          </tr>
        </thead>
        <tbody>
          <%
            opportunities = [
              { priority: 1, title: 'Optimisation tarif électricité', site: 'Tour Montparnasse', category: 'Énergie', savings: 18500, investment: 0, roi: '0 mois', status: 'À démarrer', status_color: '#3b82f6' },
              { priority: 2, title: 'Renégociation contrat maintenance CVC', site: 'Campus La Défense', category: 'Contrats', savings: 12800, investment: 0, roi: '0 mois', status: 'À démarrer', status_color: '#3b82f6' },
              { priority: 3, title: 'Installation LED - Bâtiment A', site: 'Tour Montparnasse', category: 'Énergie', savings: 8200, investment: 15000, roi: '22 mois', status: 'En cours', status_color: '#f59e0b' },
              { priority: 4, title: 'Optimisation chauffage zones inoccupées', site: 'Campus La Défense', category: 'Énergie', savings: 7500, investment: 2000, roi: '3 mois', status: 'À démarrer', status_color: '#3b82f6' },
              { priority: 5, title: 'Regroupement contrats nettoyage', site: 'Tous sites', category: 'Contrats', savings: 9200, investment: 0, roi: '0 mois', status: 'À démarrer', status_color: '#3b82f6' },
              { priority: 6, title: 'Réduction consommation eau', site: 'Tour Montparnasse', category: 'Énergie', savings: 4800, investment: 8500, roi: '21 mois', status: 'Planifié', status_color: '#22c55e' },
              { priority: 7, title: 'Optimisation fréquence maintenance', site: 'Campus La Défense', category: 'Maintenance', savings: 6700, investment: 0, roi: '0 mois', status: 'À démarrer', status_color: '#3b82f6' },
              { priority: 8, title: 'Remplacement chaudière vétuste', site: 'Tour Montparnasse', category: 'Équipements', savings: 11200, investment: 45000, roi: '48 mois', status: 'Étude', status_color: '#6b7280' },
              { priority: 9, title: 'Mutualisation prestataires sécurité', site: 'Tous sites', category: 'Contrats', savings: 8900, investment: 0, roi: '0 mois', status: 'À démarrer', status_color: '#3b82f6' },
              { priority: 10, title: 'Installation capteurs occupation', site: 'Campus La Défense', category: 'Énergie', savings: 5400, investment: 12000, roi: '27 mois', status: 'Planifié', status_color: '#22c55e' }
            ]
          %>

          <% opportunities.each do |opp| %>
            <tr style="border-bottom: 1px solid #eee;">
              <td style="padding: var(--space-md);">
                <span style="display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; background-color: <%= opp[:priority] <= 3 ? '#fee2e2' : '#f3f4f6' %>; color: <%= opp[:priority] <= 3 ? '#dc2626' : '#6b7280' %>; border-radius: 50%; font-weight: 700; font-size: 0.875rem;">
                  <%= opp[:priority] %>
                </span>
              </td>
              <td style="padding: var(--space-md);">
                <p class="typo-body-small typo-bold" style="margin-bottom: 2px;"><%= opp[:title] %></p>
              </td>
              <td class="typo-body-small" style="padding: var(--space-md); color: #666;"><%= opp[:site] %></td>
              <td style="padding: var(--space-md);">
                <span style="display: inline-block; padding: 4px 10px; background-color: #e7f3ff; color: #0066cc; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                  <%= opp[:category] %>
                </span>
              </td>
              <td class="typo-body-small typo-bold" style="padding: var(--space-md); color: #22c55e;"><%= number_to_currency(opp[:savings], unit: '', precision: 0, delimiter: ' ') %> €</td>
              <td class="typo-body-small" style="padding: var(--space-md); color: #666;"><%= opp[:investment] > 0 ? "#{number_to_currency(opp[:investment], unit: '', precision: 0, delimiter: ' ')} €" : '-' %></td>
              <td class="typo-body-small typo-bold" style="padding: var(--space-md);"><%= opp[:roi] %></td>
              <td style="padding: var(--space-md);">
                <span style="display: inline-block; padding: 4px 10px; background-color: <%= opp[:status_color] %>15; color: <%= opp[:status_color] %>; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                  <%= opp[:status] %>
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recommendations -->
  <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: var(--space-xl); border-radius: var(--space-md); border-left: 4px solid #3b82f6;">
    <div style="display: flex; gap: var(--space-lg); align-items: start;">
      <div style="background-color: #3b82f6; padding: var(--space-md); border-radius: 50%; flex-shrink: 0;">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
      </div>
      <div style="flex: 1;">
        <h4 class="typo-h4" style="color: #1e40af; margin-bottom: var(--space-md);">Recommandations Prioritaires</h4>
        <ul style="list-style: none; padding: 0; margin: 0; display: grid; gap: var(--space-sm);">
          <li style="display: flex; align-items: start; gap: var(--space-sm);">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="#3b82f6" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="typo-body-small"><strong>Court terme (0-3 mois) :</strong> Prioriser les économies sans investissement (renégociations de contrats, optimisations tarifaires)</span>
          </li>
          <li style="display: flex; align-items: start; gap: var(--space-sm);">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="#3b82f6" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="typo-body-small"><strong>Moyen terme (3-12 mois) :</strong> Lancer les projets avec ROI inférieur à 24 mois (LED, capteurs)</span>
          </li>
          <li style="display: flex; align-items: start; gap: var(--space-sm);">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="#3b82f6" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="typo-body-small"><strong>Actions immédiates :</strong> 5 opportunités représentant 56 400 € d'économies sans investissement sont à démarrer immédiatement</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
