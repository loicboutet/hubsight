<% content_for :header, "Paramètres" %>

<div class="section">
  <!-- Flash Messages -->
  <% if flash[:notice] %>
    <div style="background-color: #d1fae5; border: 1px solid #34d399; color: #065f46; padding: 1rem; border-radius: 8px; margin-bottom: var(--space-lg); display: flex; align-items: center; gap: 12px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span><%= flash[:notice] %></span>
    </div>
  <% end %>
  
  <% if flash[:alert] %>
    <div style="background-color: #fee2e2; border: 1px solid #ef4444; color: #991b1b; padding: 1rem; border-radius: 8px; margin-bottom: var(--space-lg); display: flex; align-items: center; gap: 12px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span><%= flash[:alert] %></span>
    </div>
  <% end %>

  <!-- Page Header -->
  <div class="page-header-responsive">
    <div>
      <h2 class="typo-h2" style="margin-bottom: var(--space-sm);">Paramètres</h2>
      <p class="typo-body-small">Gérez vos informations personnelles et votre sécurité</p>
    </div>
  </div>

  <!-- Settings Content -->
  <div style="margin-top: var(--space-xl); max-width: 800px;">
    
    <!-- Profile Information Section -->
    <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-xl); margin-bottom: var(--space-lg); border: 1px solid var(--pink-pale);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
        <h3 class="typo-h3" style="margin: 0;">Informations Personnelles</h3>
        <span style="background-color: var(--coral-primary); color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
          <%= current_user.role.titleize %>
        </span>
      </div>
      
      <%= form_with model: current_user, url: settings_path, method: :patch, local: true do |f| %>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg);">
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
              Prénom <span style="color: var(--coral-primary);">*</span>
            </label>
            <%= f.text_field :first_name, 
                value: current_user.first_name, 
                required: true,
                style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
          </div>
          
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
              Nom <span style="color: var(--coral-primary);">*</span>
            </label>
            <%= f.text_field :last_name, 
                value: current_user.last_name, 
                required: true,
                style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-xl);">
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
              Email <span style="color: var(--coral-primary);">*</span>
            </label>
            <%= f.email_field :email, 
                value: current_user.email, 
                required: true,
                style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
          </div>
          
          <div>
            <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
              Téléphone
            </label>
            <%= f.text_field :phone, 
                value: current_user.phone, 
                placeholder: "+33 1 23 45 67 89",
                style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
          </div>
        </div>
        
        <div style="display: flex; gap: var(--space-md);">
          <button type="submit" class="typo-btn-success" style="display: inline-flex; align-items: center; gap: var(--space-sm);">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Enregistrer les modifications
          </button>
          <%= link_to "Annuler", settings_path, class: "typo-btn-cancel" %>
        </div>
      <% end %>
    </div>

    <!-- Security / Password Section -->
    <div style="background-color: var(--white); border-radius: var(--space-md); padding: var(--space-xl); border: 1px solid var(--pink-pale);">
      <h3 class="typo-h3" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">Sécurité</h3>
      
      <%= form_with model: current_user, url: settings_path, method: :patch, local: true do |f| %>
        <div style="margin-bottom: var(--space-lg);">
          <h4 class="typo-h4" style="margin-bottom: var(--space-md); font-size: 1.105rem;">Changer le mot de passe</h4>
          <p class="typo-body-small" style="color: var(--medium-gray); margin-bottom: var(--space-lg);">
            Pour modifier votre mot de passe, veuillez remplir tous les champs ci-dessous.
          </p>
          
          <div style="display: flex; flex-direction: column; gap: var(--space-md); max-width: 500px;">
            <div>
              <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
                Mot de passe actuel <span style="color: var(--coral-primary);">*</span>
              </label>
              <%= f.password_field :current_password, 
                  autocomplete: "current-password",
                  placeholder: "Entrez votre mot de passe actuel",
                  style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
            </div>
            
            <div>
              <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
                Nouveau mot de passe <span style="color: var(--coral-primary);">*</span>
              </label>
              <%= f.password_field :password, 
                  autocomplete: "new-password",
                  placeholder: "Entrez votre nouveau mot de passe",
                  style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
              
              <!-- Password Requirements Hint -->
              <div style="margin-top: var(--space-sm); padding: var(--space-md); background-color: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 4px;">
                <p class="typo-body-small" style="font-weight: 600; color: #1e40af; margin-bottom: var(--space-xs);">
                  Le mot de passe doit respecter les critères suivants :
                </p>
                <ul class="typo-body-small" style="color: #1e40af; margin: 0; padding-left: 20px; line-height: 1.6;">
                  <li>Contenir au moins 8 caractères</li>
                  <li>Contenir au moins une lettre majuscule (A-Z)</li>
                  <li>Contenir au moins une lettre minuscule (a-z)</li>
                  <li>Contenir au moins un chiffre (0-9)</li>
                  <li>Contenir au moins un caractère spécial (!@#$%^&*)</li>
                </ul>
              </div>
            </div>
            
            <div>
              <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">
                Confirmer le nouveau mot de passe <span style="color: var(--coral-primary);">*</span>
              </label>
              <%= f.password_field :password_confirmation, 
                  autocomplete: "new-password",
                  placeholder: "Retapez le nouveau mot de passe",
                  style: "width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);" %>
            </div>
          </div>
        </div>
        
        <div style="display: flex; gap: var(--space-md);">
          <button type="submit" class="typo-btn-success" style="display: inline-flex; align-items: center; gap: var(--space-sm);">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            Mettre à jour le mot de passe
          </button>
          <%= link_to "Annuler", settings_path, class: "typo-btn-cancel" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
