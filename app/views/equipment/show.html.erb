<% content_for :header, "Équipement" %>

<div class="section">
  <!-- Breadcrumb Navigation -->
  <% site_icon = capture { render 'shared/hierarchy_icons', type: 'site', size: 16 } %>
  <% building_icon = capture { render 'shared/hierarchy_icons', type: 'building', size: 16 } %>
  <% level_icon = capture { render 'shared/hierarchy_icons', type: 'level', size: 16 } %>
  <% space_icon = capture { render 'shared/hierarchy_icons', type: 'space', size: 16 } %>
  <% equipment_icon = capture { render 'shared/hierarchy_icons', type: 'equipment', size: 16 } %>
  <% 
    breadcrumb_path = [{ name: 'Sites', url: sites_path, icon: site_icon }]
    
    if @equipment.space&.level&.building&.site
      breadcrumb_path << { name: @equipment.space.level.building.site.name, url: site_path(@equipment.space.level.building.site), icon: site_icon }
    end
    
    if @equipment.space&.level&.building
      breadcrumb_path << { name: @equipment.space.level.building.name, url: building_path(@equipment.space.level.building), icon: building_icon }
    end
    
    if @equipment.space&.level
      breadcrumb_path << { name: @equipment.space.level.name, url: level_path(@equipment.space.level), icon: level_icon }
    end
    
    if @equipment.space
      breadcrumb_path << { name: @equipment.space.name, url: space_path(@equipment.space), icon: space_icon }
    end
    
    breadcrumb_path << { name: @equipment.name, url: nil, icon: equipment_icon }
  %>
  <%= render 'shared/breadcrumb', path: breadcrumb_path %>

  <!-- Header Section -->
  <div style="margin-bottom: var(--space-xl); display: flex; justify-content: space-between; align-items: center;">
    <div style="display: flex; align-items: center; gap: var(--space-md);">
      <%= render 'shared/hierarchy_icons', type: 'equipment', size: 32, color: 'var(--coral-primary)' %>
      <div>
        <h2 class="typo-h2" style="margin-bottom: var(--space-xs);"><%= @equipment.name %></h2>
        <p class="typo-body-small" style="color: var(--medium-gray);"><%= @equipment.location_path %></p>
      </div>
    </div>
    <div style="display: flex; gap: var(--space-md);">
      <%= link_to edit_equipment_path(@equipment), class: "typo-btn-small typo-btn-small-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        Éditer
      <% end %>
      <button 
        type="button"
        data-action="open-delete-modal"
        data-modal-id="deletion-modal-<%= @equipment.id %>"
        class="typo-btn-small typo-btn-small-danger"
        style="display: inline-flex; align-items: center; gap: 8px; border: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Supprimer
      </button>
      <%= link_to @equipment.space ? space_path(@equipment.space) : equipment_path(@equipment), class: "typo-btn-cancel" do %>
        ← Retour à l'Espace
      <% end %>
    </div>
  </div>

  <div style="background-color: var(--white); border-radius: var(--space-md);">
    
    <!-- Basic Information Section -->
    <div style="margin-bottom: var(--space-xl);">
      <h4 class="typo-h4" style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 2px solid var(--pink-pale);">
        Informations de Base
      </h4>
      
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-lg);">
        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Nom de l'Équipement</p>
          <p class="typo-body-small typo-bold"><%= @equipment.name %></p>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Type d'Équipement</p>
          <% if @equipment.equipment_type %>
            <p class="typo-body-small typo-bold">
              <%= @equipment.equipment_type.equipment_type_name %>
              <% if @equipment.equipment_type.technical_lot_trigram.present? %>
                <span style="display: inline-block; margin-left: 8px; padding: 4px 8px; background-color: <%= case @equipment.equipment_type.lot_badge_color when 'blue' then '#3b82f6' when 'yellow' then '#f59e0b' when 'cyan' then '#06b6d4' when 'red' then '#ef4444' when 'purple' then '#a855f7' when 'green' then '#10b981' when 'orange' then '#f97316' when 'indigo' then '#6366f1' else '#6b7280' end %>; color: white; border-radius: 4px; font-size: 11px; font-weight: 600;">
                  <%= @equipment.equipment_type.technical_lot_trigram %>
                </span>
              <% end %>
            </p>
          <% else %>
            <p class="typo-body-small typo-bold"><%= @equipment.equipment_type || "Non spécifié" %></p>
          <% end %>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Fabricant / Marque</p>
          <p class="typo-body-small typo-bold"><%= @equipment.manufacturer.presence || "Non spécifié" %></p>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Modèle</p>
          <p class="typo-body-small typo-bold"><%= @equipment.model.presence || "Non spécifié" %></p>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Numéro de Série</p>
          <p class="typo-body-small typo-bold"><%= @equipment.serial_number.presence || "Non spécifié" %></p>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Référence BDD</p>
          <p class="typo-body-small typo-bold"><%= @equipment.bdd_reference.presence || "Non spécifié" %></p>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Référence OmniClass</p>
          <% if @equipment.equipment_type&.omniclass_number.present? %>
            <p class="typo-body-small typo-bold">
              <%= @equipment.equipment_type.omniclass_number %>
              <% if @equipment.equipment_type.omniclass_title.present? %>
                <span style="color: var(--medium-gray); font-weight: normal;">(<%= @equipment.equipment_type.omniclass_title %>)</span>
              <% end %>
            </p>
          <% else %>
            <p class="typo-body-small" style="color: var(--medium-gray);">Non spécifié</p>
          <% end %>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Sous-domaine Achat</p>
          <% if @equipment.equipment_type&.purchase_subfamily.present? %>
            <p class="typo-body-small typo-bold">
              <%= @equipment.equipment_type.technical_lot_trigram %> - <%= @equipment.equipment_type.purchase_subfamily %>
            </p>
          <% elsif @equipment.equipment_type&.technical_lot.present? %>
            <p class="typo-body-small typo-bold"><%= @equipment.equipment_type.technical_lot %></p>
          <% else %>
            <p class="typo-body-small" style="color: var(--medium-gray);">Non spécifié</p>
          <% end %>
        </div>

        <div>
          <p class="typo-body-small" style="color: var(--medium-gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: var(--space-xs);">Emplacement</p>
          <p class="typo-body-small typo-bold"><%= @equipment.location_path.presence || "Non spécifié" %></p>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; gap: var(--space-md); justify-content: flex-end; padding-top: var(--space-lg); border-top: 1px solid var(--pink-pale);">
      <%= link_to @equipment.space ? space_path(@equipment.space) : equipment_path(@equipment), class: "typo-btn-cancel", style: "display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Retour à l'Espace
      <% end %>
      <%= link_to edit_equipment_path(@equipment), class: "typo-btn-primary", style: "cursor: pointer; display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        Éditer l'Équipement
      <% end %>
    </div>
  </div>
</div>

<!-- Deletion Confirmation Modal -->
<%= render 'shared/deletion_confirmation_modal',
    entity_type: "l'équipement",
    entity_name: @equipment.name,
    entity_id: @equipment.id,
    affected_items: {},
    requires_extra_confirmation: false,
    delete_path: equipment_path(@equipment) %>

<!-- Load deletion confirmation controller -->
<div data-controller="deletion-confirmation"></div>
