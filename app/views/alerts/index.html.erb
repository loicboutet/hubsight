<% content_for :header, "Alertes Contractuelles" %>

<div class="section">
  <div class="page-header-responsive">
    <div>
      <h2 class="typo-h2" style="margin-bottom: var(--space-sm);">Tableau de Bord des Alertes</h2>
      <p class="typo-body-small">Gérer les alertes contractuelles et échéances</p>
    </div>
    <%= link_to settings_alerts_path, class: "typo-btn-success", style: "display: inline-flex; align-items: center; gap: var(--space-sm);" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      Paramètres des Alertes
    <% end %>
  </div>

  <!-- Stats Cards -->
  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-lg); margin-bottom: var(--space-2xl);">
    <div style="background: linear-gradient(135deg, rgba(245, 101, 101, 0.05) 0%, rgba(245, 101, 101, 0.1) 100%); padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #f56565;">
      <p style="color: var(--medium-gray); font-size: 0.7rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">Alertes Actives</p>
      <p style="color: #f56565; font-size: 1.4rem; font-weight: 700; margin: 0;">12</p>
    </div>
    <div style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 193, 7, 0.1) 100%); padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #ffc107;">
      <p style="color: var(--medium-gray); font-size: 0.7rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">À Venir</p>
      <p style="color: #ffc107; font-size: 1.4rem; font-weight: 700; margin: 0;">8</p>
    </div>
    <div style="background: linear-gradient(135deg, rgba(220, 53, 69, 0.05) 0%, rgba(220, 53, 69, 0.1) 100%); padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #dc3545;">
      <p style="color: var(--medium-gray); font-size: 0.7rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">En Risque</p>
      <p style="color: #dc3545; font-size: 1.4rem; font-weight: 700; margin: 0;">3</p>
    </div>
    <div style="background: linear-gradient(135deg, rgba(72, 187, 120, 0.05) 0%, rgba(72, 187, 120, 0.1) 100%); padding: var(--space-md); border-radius: var(--space-sm); border-left: 4px solid #48bb78;">
      <p style="color: var(--medium-gray); font-size: 0.7rem; margin-bottom: 6px; text-transform: uppercase; font-weight: 600;">Validées</p>
      <p style="color: #48bb78; font-size: 1.4rem; font-weight: 700; margin: 0;">45</p>
    </div>
  </div>

  <div style="background-color: var(--white); border-radius: var(--space-md);">
    
    <!-- Filters Section -->
    <div style="margin-bottom: var(--space-xl); padding: var(--space-lg); background-color: #f8f9fa; border-radius: var(--space-sm);">
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto auto; gap: var(--space-md); align-items: end;">
        <div>
          <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">Type d'Alerte</label>
          <select style="width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);">
            <option>Toutes</option>
            <option>À venir</option>
            <option>En risque</option>
            <option>Contrats manquants</option>
          </select>
        </div>
        <div>
          <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">Statut</label>
          <select style="width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);">
            <option>Tous</option>
            <option>Active</option>
            <option>Validée</option>
            <option>Ignorée</option>
          </select>
        </div>
        <div>
          <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">Site</label>
          <select style="width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);">
            <option>Tous les sites</option>
            <option>Tour Montparnasse</option>
            <option>Campus La Défense</option>
          </select>
        </div>
        <div>
          <label class="typo-body-small typo-bold" style="display: block; margin-bottom: var(--space-sm);">Période</label>
          <select style="width: 100%; padding: 10px; border: 1px solid var(--light-gray); border-radius: var(--space-sm);">
            <option>Toutes</option>
            <option>7 prochains jours</option>
            <option>30 prochains jours</option>
            <option>Dépassées</option>
          </select>
        </div>
        <button type="button" class="typo-btn-cancel" style="display: inline-flex; align-items: center; gap: var(--space-sm);">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
          Effacer
        </button>
        <button type="submit" class="typo-btn-success" style="display: inline-flex; align-items: center; gap: var(--space-sm);">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
          </svg>
          Filtrer
        </button>
      </div>
    </div>

    <!-- Alerts List -->
    <div style="display: grid; gap: var(--space-md); margin-bottom: var(--space-xl);">
      <%
        alerts_list = [
          {id: 1, type: 'En risque', title: 'Résiliation non effectuée - CTR-2024-156', contract: 'CTR-2024-156', site: 'Tour Montparnasse', date: 'Dépassé de 5 jours', deadline: '15/01/2025', status: 'Active', color: '#dc3545'},
          {id: 2, type: 'À venir', title: 'Échéance contrat maintenance ascenseur', contract: 'CTR-2024-189', site: 'Campus La Défense', date: 'Dans 15 jours', deadline: '10/02/2025', status: 'Active', color: '#ffc107'},
          {id: 3, type: 'Contrats manquants', title: 'Contrôle réglementaire CVC manquant', contract: '-', site: 'Site Industriel Lyon', date: 'Requis', deadline: '-', status: 'Active', color: '#f56565'},
          {id: 4, type: 'À venir', title: 'Renouvellement contrat nettoyage', contract: 'CTR-2025-003', site: 'Tour Montparnasse', date: 'Dans 30 jours', deadline: '25/02/2025', status: 'Active', color: '#ffc107'},
          {id: 5, type: 'En risque', title: 'Date limite résiliation dépassée', contract: 'CTR-2024-145', site: 'Campus La Défense', date: 'Dépassé de 2 jours', deadline: '23/01/2025', status: 'Active', color: '#dc3545'},
          {id: 6, type: 'À venir', title: 'Contrôle technique réglementaire', contract: 'CTR-2024-201', site: 'Site Industriel Lyon', date: 'Dans 45 jours', deadline: '15/03/2025', status: 'Validée', color: '#48bb78'},
        ]
      %>

      <% alerts_list.each do |alert| %>
        <div style="padding: var(--space-lg); background-color: #f8f9fa; border-radius: var(--space-md); border-left: 4px solid <%= alert[:color] %>;">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
              <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-sm);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="<%= alert[:color] %>">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                <h5 class="typo-h5" style="color: var(--dark-gray); margin-bottom: 0;"><%= alert[:title] %></h5>
              </div>
              
              <div style="display: flex; gap: var(--space-lg); margin-bottom: var(--space-md);">
                <div style="display: flex; align-items: center; gap: var(--space-xs);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#6b7280">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  <span class="typo-body-small" style="color: var(--medium-gray);">Contrat: <%= alert[:contract] %></span>
                </div>
                <div style="display: flex; align-items: center; gap: var(--space-xs);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#6b7280">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                  </svg>
                  <span class="typo-body-small" style="color: var(--medium-gray);">Site: <%= alert[:site] %></span>
                </div>
              </div>
              
              <div style="display: flex; gap: var(--space-lg); flex-wrap: wrap;">
                <span style="display: inline-block; padding: 4px 10px; background-color: <%= alert[:color] %>20; color: <%= alert[:color] %>; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                  <%= alert[:type] %>
                </span>
                <span style="display: inline-block; padding: 4px 10px; background-color: <%= alert[:status] == 'Active' ? '#fff3cd' : '#d4edda' %>; color: <%= alert[:status] == 'Active' ? '#856404' : '#155724' %>; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                  <%= alert[:status] %>
                </span>
                <div style="display: flex; align-items: center; gap: var(--space-xs);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#6b7280">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  <span class="typo-body-small" style="color: var(--medium-gray); font-weight: 600;"><%= alert[:date] %></span>
                </div>
              </div>
            </div>
            
            <div style="display: flex; gap: var(--space-xs); flex-wrap: wrap;">
              <%= link_to alert_path(alert[:id]), class: "typo-btn-small typo-btn-small-secondary" do %>
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Voir
              <% end %>
              <% if alert[:status] == 'Active' %>
                <%= link_to "#", class: "typo-btn-small typo-btn-small-primary", onclick: "return confirm('Valider cette alerte ?');" do %>
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  Valider
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Pagination -->
    <div style="margin-top: var(--space-xl);">
      <%= render 'shared/pagination', 
        current_page: 1, 
        total_pages: 3, 
        total_count: 28, 
        per_page: 10,
        path: alerts_path %>
    </div>
  </div>
</div>
