<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HubSight - Project Backlogs</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background-color: #f5f5f5; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background-color: white; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; }
        h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2.5em; }
        .subtitle { color: #7f8c8d; margin-bottom: 30px; font-size: 1.1em; }
        .stats { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; flex: 1; min-width: 200px; }
        .stat-number { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .stat-label { opacity: 0.9; font-size: 0.9em; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        thead { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        th { padding: 15px 12px; text-align: left; font-weight: 600; position: sticky; top: 0; z-index: 10; }
        td { padding: 12px; border-bottom: 1px solid #e0e0e0; vertical-align: top; }
        tr:hover { background-color: #f8f9fa; }
        .sl-col { width: 60px; text-align: center; font-weight: bold; color: #667eea; }
        .brick-col { width: 100px; font-weight: 600; color: #764ba2; }
        .title-col { width: 250px; font-weight: 600; color: #2c3e50; }
        .description-col { min-width: 300px; }
        .url-col { width: 200px; word-break: break-word; }
        .url-col a { color: #667eea; text-decoration: none; }
        .url-col a:hover { text-decoration: underline; }
        .test-col { min-width: 350px; font-size: 13px; color: #555; }
        .video-col { width: 120px; text-align: center; }
        .empty-cell { color: #bdc3c7; font-style: italic; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-left: 8px; }
        .status-done { background-color: #4caf50; color: white; }
        tr.implemented { background-color: #e8f5e9; }
        tr.implemented:hover { background-color: #c8e6c9; }
        @media (max-width: 768px) { .container { padding: 15px; } h1 { font-size: 1.8em; } table { font-size: 12px; } th, td { padding: 8px 6px; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ HubSight - Project Backlogs</h1>
        <p class="subtitle">Complete task breakdown for Brick 1 implementation</p>
        <div class="stats">
            <div class="stat-card"><div class="stat-number">56</div><div class="stat-label">Total Tasks</div></div>
            <div class="stat-card"><div class="stat-number">1</div><div class="stat-label">Brick Phase</div></div>
            <div class="stat-card"><div class="stat-number">16</div><div class="stat-label">Tasks Implemented</div></div>
        </div>
        <table>
            <thead>
                <tr>
                    <th class="sl-col">SL</th>
                    <th class="brick-col">Brick</th>
                    <th class="title-col">Task Title</th>
                    <th class="description-col">Task Description</th>
                    <th class="url-col">URL</th>
                    <th class="test-col">How to Test</th>
                    <th class="video-col">Video</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="sl-col">1</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">User Registration - Sign Up</td>
                    <td class="description-col">Implement user registration/signup form with email, password, name fields. Email verification required before account activation</td>
                    <td class="url-col"><a href="/admin/portfolio_managers/new">/admin/portfolio_managers/new</a> or <a href="/site_managers/new">/site_managers/new</a></td>
                    <td class="test-col">Login as admin (admin@hubsight.com / Password123!), go to /admin/portfolio_managers/new, fill email/first_name/last_name, click Create. Invitation email opens in browser. Click invitation link, set strong password (8+ chars, uppercase, lowercase, digit, special char), activate account. Verify real-time password strength meter shows weak/medium/strong. Verify all requirements turn green with checkmarks.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">2</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">User Login - Sign In</td>
                    <td class="description-col">Implement secure login functionality with email/password, remember me option, and failed login attempt tracking</td>
                    <td class="url-col"><a href="/login">/login</a></td>
                    <td class="test-col">Go to /login, enter email/password, check 'Remember me', click Sign In. Verify redirect to /dashboard. Try wrong password 5 times - account locks. Check letter_opener for unlock email. Click unlock link. Login again successfully. Verify login count increments in profile.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">3</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Password Reset - Forgot Password</td>
                    <td class="description-col">Implement password reset flow: request reset link via email, verify token, set new password with strength validation</td>
                    <td class="url-col"><a href="/password/new">/password/new</a></td>
                    <td class="test-col">Go to /login, click 'Forgot password?', enter email, submit. Check letter_opener for reset email. Click reset link, enter new strong password (watch strength meter), confirm password, submit. Login with new password. Verify password strength validation works.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">4</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Email Verification</td>
                    <td class="description-col">Email confirmation system: send verification email on signup, validate confirmation token, activate account</td>
                    <td class="url-col"><a href="Automatic on invitation acceptance">Automatic on invitation acceptance</a></td>
                    <td class="test-col">When accepting invitation (/invitations/accept/:token), email is auto-confirmed. For email changes: go to /profile/edit, change email, save. Check letter_opener for confirmation email. Click confirmation link. Verify new email confirmed and active.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">5</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">User Profile Management</td>
                    <td class="description-col">Allow users to update their profile: name, email, password, notification preferences, language settings</td>
                    <td class="url-col"><a href="/profile/edit">/profile/edit</a></td>
                    <td class="test-col">Login, go to /profile/edit. Update first/last name, phone, department, language (fr/en). Toggle notification preferences (4 checkboxes). To change password: enter current password, new password (watch strength meter), confirm. Click Save. Verify changes persist. Check login history shows: sign-in count, current/last IP, timestamps.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">6</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Session Management</td>
                    <td class="description-col">Secure session handling with timeout, remember me cookie, concurrent session management, logout functionality</td>
                    <td class="url-col"><a href="/active_sessions">/active_sessions</a></td>
                    <td class="test-col">Login, go to /active_sessions. View active sessions showing device type, browser, OS, IP, timestamps. Login from different browser/device - see multiple sessions listed. Click 'Terminer' on non-current session - that device logged out. Verify cannot end current session. Wait 30 min inactive - session expires. Run CleanupSessionsJob.perform_now in console to test cleanup.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">7</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Role-Based Access Control (RBAC)</td>
                    <td class="description-col">Implement role-based permissions system for Admin, Portfolio Manager, Site Manager, and Technician roles</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">8</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Admin - Create Portfolio Manager Account</td>
                    <td class="description-col">Implement functionality for Admin to create and configure Portfolio Manager accounts with proper permissions and organization assignment</td>
                    <td class="url-col"><a href="/admin/portfolio_managers/new">/admin/portfolio_managers/new</a></td>
                    <td class="test-col">Login as admin (admin@hubsight.com / Password123!). Click 'Gestionnaires' in the admin sidebar menu under 'Administration' section. View existing portfolio managers with their organizations and invitation status. Click 'Nouveau Gestionnaire' button. Fill required fields: email, first_name, last_name, select organization from dropdown (or create new via link). Click 'Cr√©er le Gestionnaire'. Verify success message appears. Check letter_opener - invitation email should open with activation link. Click invitation link, set strong password (8+ chars, uppercase, lowercase, digit, special char), watch real-time strength meter. Accept invitation. Login with new credentials. Verify portfolio manager can access their organization's data. Test editing: click 'Modifier' on portfolio manager, update details, save. Verify resend invitation works for pending invitations. Verify admin-only access (non-admin users redirected).</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">9</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Admin - Access Client Data</td>
                    <td class="description-col">Enable Admin to access client data with formalized contractual authorization, including data isolation and audit logging</td>
                    <td class="url-col"><a href="/admin/clients">/admin/clients</a></td>
                    <td class="test-col">Login as admin (admin@hubsight.com / Password123!). Navigate to /admin/clients to view all client organizations with user statistics. Click 'Acc√©der aux donn√©es' button for any organization. Confirm security warning dialog. Verify prominent red banner appears at top showing organization name with 'Terminer l'acc√®s' button. Access client data (sites, contracts, equipment) - verify all queries automatically scoped to selected organization. Navigate to /admin/access_logs to view audit trail - verify log entry shows: admin email, organization name, IP address, start time, status 'Active'. Click 'Terminer l'acc√®s' in red banner - verify redirect to /admin/clients with success message. Return to /admin/access_logs - verify log entry now shows 'Termin√©e' status with duration calculated. Test timeout: start impersonation, wait 2+ hours (or modify timeout in code for testing), attempt page access - verify automatic session end with timeout message. Test data isolation: impersonate Org A, verify cannot access Org B data. Verify all impersonation features admin-only (non-admin users blocked).</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">10</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">Admin - Client Impersonation</td>
                    <td class="description-col">Implement secure client impersonation feature allowing Admin to view and navigate the platform as a specific client for support purposes</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">11</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create Site Manager Profiles</td>
                    <td class="description-col">Portfolio Manager can create and manage Site Manager profiles for their organization with role-based permissions</td>
                    <td class="url-col"><a href="/site_managers">/site_managers</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /site_managers to view list of site managers. Click 'Nouveau Responsable' button. Fill required fields: email, first_name, last_name, phone. Fill optional fields: department, status (active/inactive). Click 'Cr√©er le Responsable'. Verify success message appears. Check letter_opener - invitation email should open with activation link. Verify site manager appears in list with 'Invitation en attente' badge. Click site manager name to view profile - verify all details displayed correctly including invitation status. Click 'Renvoyer l'invitation' button - verify new invitation email sent. Click invitation link, set strong password (8+ chars, uppercase, lowercase, digit, special char), activate account. Login as new site manager - verify access granted. Logout, login as portfolio manager. Click '√âditer' on site manager - update first_name, last_name, phone, department, status. Save changes - verify updates persist. Test filters: search by name/email, filter by status (active/inactive/pending), filter by sites assigned. Click 'Sites' button - verify redirects to /site_managers/:id/assign_sites (site assignment feature from task 12). Test authorization: logout, login as site_manager - verify cannot access /site_managers (redirected with error). Test organization isolation: login as portfolio2@hubsight.com - verify sees only their organization's site managers (not Organization 1's site managers).</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">12</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Assign Sites to Site Managers<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Implement site assignment functionality allowing Portfolio Managers to assign specific sites to Site Manager users</td>
                    <td class="url-col"><a href="/site_managers/:id/assign_sites">/site_managers/:id/assign_sites</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /site_managers to view list of site managers. Click on a site manager (e.g., Pierre Bernard). On the profile page, click "G√©rer les Sites" button. Verify you're redirected to /site_managers/:id/assign_sites. View available sites from your organization with checkboxes. Test "Tout s√©lectionner/Tout d√©s√©lectionner" to select/deselect all sites. Verify counter updates in real-time showing "X site(s) s√©lectionn√©(s)". Select specific sites by checking individual boxes. Verify counter increments/decrements correctly. Click "Enregistrer les Assignations". Verify success message "Sites assign√©s avec succ√®s." Verify redirect back to site manager profile (/site_managers/:id). Verify "Sites Assign√©s" section now displays assigned sites count (no longer hardcoded 0). Test unassigning: click "G√©rer les Sites" again, uncheck some sites, save. Verify assignments update correctly. Test with multiple site managers to ensure independent assignments. Verify database: check site_assignments table has records with user_id, site_id, assigned_by_name. Test site manager access: login as assigned site manager, go to /my_sites, verify only assigned sites visible (see task 47 for full SM testing).</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">13</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create and Manage Sites</td>
                    <td class="description-col">Full CRUD functionality for sites including name, address, area, site type, and other attributes from the data model</td>
                    <td class="url-col"><a href="/sites">/sites</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Click 'Sites' in sidebar menu. View list of 13 sites with pagination (10 per page). Click 'Nouveau Site' - fill required fields (name, type, address, city, postal code) and optional fields (code, area, contact info, GPS, climate zone, etc.), submit. Click site name to view details. Click '√âditer' to update. Test filters: search by name/city, filter by site type (8 types), filter by region (13 regions), sort options. Click 'Supprimer' and confirm deletion. Navigate pages 1-2 to verify pagination. Login as portfolio2@hubsight.com to verify multi-tenancy (sees only their 12 sites). Verify sites menu accessible from both Admin and User layouts.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">14</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create and Manage Buildings<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Full CRUD functionality for buildings nested under sites, including construction year, area, ERP classification, energy data, etc.</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Go to a site detail page (e.g., /sites/1). Click 'B√¢timents' tab to view list of buildings. Click 'Nouveau B√¢timent' - fill required fields (name, code, construction year, area, status) and optional fields (description, cadastral reference, renovation year, number of levels, height, structure type, ERP category/type, capacity, PMR accessibility, environmental certification, energy consumption, DPE rating, GHG rating, notes). Click 'Cr√©er'. View building details page showing all information and data source tracking (created by, updated by, import source). Click '√âditer' to update building. Test delete functionality. Verify buildings list shows area, levels count, spaces count, equipment count, construction year, and status.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">15</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create and Manage Levels<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Full CRUD functionality for levels (floors) nested under buildings, including level number, altitude, and floor area</td>
                    <td class="url-col"><a href="/buildings/:building_id/levels">/buildings/:building_id/levels</a></td>
                    <td class="test-col">PREREQUISITES: Task 14 (Buildings) must be completed first. Login as portfolio manager (portfolio@hubsight.com / Password123!). 
                    
CREATE TEST: Go to /sites, select a site, click 'B√¢timents' tab, select a building. On building detail page, look for 'Niveaux' section or navigate directly to /buildings/:building_id/levels. Click 'Nouveau Niveau' button. Fill REQUIRED field: name (examples: "Rez-de-chauss√©e", "1er √©tage", "2√®me √©tage", "Sous-sol -1"). Fill OPTIONAL fields: level_number (numeric: -2=basement 2, -1=basement 1, 0=ground floor, 1=floor 1, 2=floor 2, etc.), altitude in meters (e.g., -3.5 for basement, 0 for ground, 3.2 for 1st floor), area in m¬≤ (e.g., 850.5). Add description if desired. Click 'Cr√©er le Niveau'. Verify: success flash message "Niveau cr√©√© avec succ√®s.", redirected to building detail page showing updated levels count, new level appears in levels list on building page.

VIEW/SHOW TEST: From levels list, click on level name to view detail page. Verify displays: level name, level_number with proper formatting, altitude (formatted as "X m" or blank if not set), area (formatted as "XXX m¬≤" or blank if not set), parent building name with link, site breadcrumb navigation, spaces count (shows 0 initially), equipment count (shows 0 initially), created_by_name, timestamps, description.

UPDATE/EDIT TEST: On level detail page, click '√âditer' button. Modify fields: change name (e.g., "Rez-de-chauss√©e" to "Ground Floor"), update level_number, change altitude value, update area. Click 'Mettre √† Jour le Niveau'. Verify: success message "Niveau mis √† jour avec succ√®s.", redirected to building detail page, changes persist when viewing level again, updated_by_name field populated with current user's name.

ORDERING TEST: Create multiple levels with different level_numbers: create "Sous-sol -1" (level_number: -1), "Rez-de-chauss√©e" (level_number: 0), "1er √©tage" (level_number: 1), "2√®me √©tage" (level_number: 2). View levels list on building page. Verify levels display in ascending order by level_number: basement first, then ground floor, then upper floors.

DELETE TEST: On level detail page or from levels list, click 'Supprimer' button. Confirm deletion in dialog. Verify: success message "Niveau supprim√© avec succ√®s.", redirected to building detail page, level removed from levels list, building's levels count decremented.

VALIDATION TESTS: Try creating level without name - should fail with validation error "Name can't be blank". Try creating level with negative area (e.g., -100) - should fail with validation error. Try invalid level_number format (e.g., "abc") - should fail. All required field validations must prevent save.

AUTHORIZATION TEST: Logout, login as different portfolio manager (portfolio2@hubsight.com / Password123!). Navigate to a building from Organization 1 (try /buildings/1). Verify redirected with error "Acc√®s non autoris√©." Cannot view, create, edit, or delete levels from other organizations' buildings.

ORGANIZATION ISOLATION TEST: Create level in Organization 1's building while logged in as portfolio@hubsight.com. Level should have organization_id matching building's organization_id. Login as portfolio2@hubsight.com, create level in Organization 2's building. Verify each organization sees only their own levels. Database check: confirm levels.organization_id matches parent building.organization_id.

DATA SOURCE TRACKING: When creating level, verify created_by_name field populated with current user's full name. When updating, verify updated_by_name field updated. These fields support import tracking (import_source, import_date) for future Excel import functionality.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">16</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create and Manage Spaces<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Full CRUD functionality for spaces/rooms nested under levels, including type, area, capacity, usage, and technical characteristics</td>
                    <td class="url-col"><a href="/levels/:level_id/spaces">/levels/:level_id/spaces</a></td>
                    <td class="test-col">PREREQUISITES: Task 15 (Levels) must be completed first. Login as portfolio manager (portfolio@hubsight.com / Password123!). 

CREATE TEST: Go to /sites, select a site, click 'B√¢timents' tab, select a building, click on a level. On level detail page, click 'Nouvel Espace' button. Fill REQUIRED field: name (examples: "Bureau 101", "Salle de r√©union A", "Local technique"). Fill OPTIONAL fields: space_type (Bureau, Salle de r√©union, Local technique, etc.), area in m¬≤ (e.g., 25.5), ceiling_height in m (e.g., 2.8), capacity in people (e.g., 10), primary_use (e.g., "Bureaux administratifs"), secondary_use, floor_covering (Moquette, Carrelage, etc.), wall_covering, ceiling_type, water_points (number), electrical_outlets (number), network_connectivity (C√¢bl√©, WiFi, etc.), natural_lighting (0-100%), ventilation type. Check comfort options: heating, air_conditioning, has_windows, pmr_accessibility. Add grouping_zone (Administrative, Technique, etc.), omniclass_code (e.g., "13-21 11 00"), notes. Click 'Cr√©er l'Espace'. Verify: success flash message "Espace cr√©√© avec succ√®s.", redirected to level detail page showing updated spaces count, new space appears in spaces list on level page.

VIEW/SHOW TEST: From spaces list, click on space name to view detail page. Verify displays: space name, type badge, area (formatted as "XXX m¬≤"), capacity, equipment count, all physical characteristics (floor_covering, wall_covering, ceiling_type, ventilation), technical infrastructure (water_points, electrical_outlets, network_connectivity, natural_lighting%), comfort features (heating, air_conditioning, has_windows, pmr_accessibility shown as Oui/Non), classification (grouping_zone, omniclass_code), parent level/building/site breadcrumb navigation, created_by_name, timestamps.

UPDATE/EDIT TEST: On space detail page, click '√âditer' button. Modify fields: change name, update space_type, change area, ceiling_height, capacity, update coverings and technical fields. Toggle comfort checkboxes. Click 'Mettre √† Jour l'Espace'. Verify: success message "Espace mis √† jour avec succ√®s.", redirected to level detail page, changes persist when viewing space again, updated_by_name field populated with current user's name.

LIST/INDEX TEST: From level page, click 'Espaces' button to view all spaces for the level (/levels/:level_id/spaces). Verify spaces display with: name, type badge, area, capacity, equipment count. Each space has 'Voir' and '√âditer' buttons. Empty state shows "Aucun espace pour ce niveau" with 'Cr√©er le premier espace' button.

DELETE TEST: On space detail page, click 'Supprimer' button. Confirm deletion in dialog. Verify: success message "Espace supprim√© avec succ√®s.", redirected to level detail page, space removed from spaces list, level's spaces count decremented.

VALIDATION TESTS: Try creating space without name - should fail with validation error "Name can't be blank". Try creating space with negative area - should fail. Try negative ceiling_height - should fail. Try negative capacity - should fail. Try natural_lighting > 100 or < 0 - should fail. All required field validations must prevent save.

AUTHORIZATION TEST: Logout, login as different portfolio manager (portfolio2@hubsight.com / Password123!). Navigate to a level from Organization 1. Verify redirected with error "Acc√®s non autoris√©." Cannot view, create, edit, or delete spaces from other organizations' levels.

ORGANIZATION ISOLATION TEST: Create space in Organization 1's level while logged in as portfolio@hubsight.com. Space should have organization_id matching level's organization_id. Login as portfolio2@hubsight.com, create space in Organization 2's level. Verify each organization sees only their own spaces.

DATA SOURCE TRACKING: When creating space, verify created_by_name field populated with current user's full name. When updating, verify updated_by_name field updated. These fields support import tracking (import_source, import_date) for future Excel import functionality.

LEVEL VIEW INTEGRATION: On level detail page (/levels/:id), verify "Espaces de ce Niveau" section displays real spaces from database (not mock data). Shows first 5 spaces with name, type badge, area, capacity, equipment count. 'Nouvel Espace' and 'Espaces' buttons link to create/list pages. Empty state shows "Aucun espace pour ce niveau".</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">17</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create and Manage Equipment<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Full CRUD functionality for equipment nested under spaces, including manufacturer, model, serial number, commissioning date, technical specs</td>
                    <td class="url-col"><a href="/equipment">/equipment</a></td>
                    <td class="test-col">PREREQUISITES: Task 16 (Spaces) must be completed first. Login as portfolio manager (portfolio@hubsight.com / Password123!). 

CREATE TEST: Go to /sites, select a site, click 'B√¢timents' tab, select a building, click on a level, select a space. On space detail page, click 'Nouvel √âquipement' button. Fill REQUIRED field: name (example: "Climatiseur Daikin AC-500"). Fill OPTIONAL fields: equipment_type, equipment_category, manufacturer (e.g., "Daikin"), model (e.g., "AC-500"), serial_number (e.g., "SN123456789"), bdd_reference, nominal_power (e.g., "3.5 kW"), nominal_voltage (e.g., "230 V"), current, frequency (e.g., "50 Hz"), weight (e.g., "45 kg"), dimensions (e.g., "80 x 60 x 120 cm"), manufacturing_date, commissioning_date, warranty_end_date, next_maintenance_date, supplier, purchase_price, order_number, invoice_number, status (Actif/Inactif/En Maintenance/Hors Service), criticality (Faible/Moyen/√âlev√©/Critique), notes. Click 'Cr√©er l'√âquipement'. Verify: success flash message "√âquipement cr√©√© avec succ√®s.", redirected to equipment detail page, new equipment appears in space's equipment list.

VIEW/SHOW TEST: From equipment list, click on equipment name to view detail page (/equipment/:id). Verify displays: equipment name, manufacturer, model, serial number, all physical characteristics, technical specifications (power, voltage, current, frequency, weight, dimensions), important dates (manufacturing, commissioning, warranty end, next maintenance), installation & warranty info, contracts & maintenance section, contacts section, supplier information (supplier, purchase price, order number, invoice number), status badge, criticality badge, notes, parent space/level/building/site breadcrumb navigation, created_by_name, updated_by_name timestamps.

UPDATE/EDIT TEST: On equipment detail page, click '√âditer' button (/equipment/:id/edit). Modify fields: change name, update manufacturer, model, serial number, change technical specs, update dates, change status, criticality. Click 'Mettre √† Jour l'√âquipement'. Verify: success message "√âquipement mis √† jour avec succ√®s.", redirected to equipment detail page, changes persist when viewing equipment again, updated_by_name field populated with current user's name.

LIST/INDEX TEST: Navigate to /equipment to view all equipment for organization. Verify equipment display with: name, type, manufacturer, model, location hierarchy (space > level > building > site), status. Each equipment has 'Voir' and '√âditer' buttons. Pagination shows 10 per page.

DELETE TEST: On equipment detail page, click 'Supprimer' button. Confirm deletion in dialog "√ätes-vous s√ªr de vouloir supprimer cet √©quipement ? Cette action est irr√©versible." Verify: success message "√âquipement supprim√© avec succ√®s.", redirected to parent space detail page, equipment removed from list, space's equipment count decremented.

VALIDATION TESTS: Try creating equipment without name - should fail with validation error "Name can't be blank". Try creating equipment with invalid numeric values - should fail. All field validations must prevent save.

AUTHORIZATION TEST: Logout, login as different portfolio manager (portfolio2@hubsight.com / Password123!). Navigate to a space from Organization 1. Verify redirected with error "Acc√®s non autoris√©." Cannot view, create, edit, or delete equipment from other organizations' spaces.

ORGANIZATION ISOLATION TEST: Create equipment in Organization 1's space while logged in as portfolio@hubsight.com. Equipment should have organization_id matching space's organization_id. Login as portfolio2@hubsight.com, create equipment in Organization 2's space. Verify each organization sees only their own equipment.

HIERARCHY TRACKING: When creating equipment, verify it inherits site_id, building_id, level_id from parent space automatically through model callbacks. Check equipment.space, equipment.level, equipment.building, equipment.site associations work correctly.

DATA SOURCE TRACKING: When creating equipment, verify created_by_name field populated with current user's full name. When updating, verify updated_by_name field updated. These fields support import tracking (import_source, import_date) for future Excel import functionality.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">18</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Tree View Navigation<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Implement hierarchical tree navigation: Portfolio > Sites > Buildings > Levels > Spaces > Equipment with expand/collapse functionality</td>
                    <td class="url-col"><a href="/portfolio">/portfolio</a></td>
                    <td class="test-col">PREREQUISITES: Tasks 13-17 (Sites, Buildings, Levels, Spaces, Equipment) must be completed first. Login as portfolio manager (portfolio@hubsight.com / Password123!).

NAVIGATION TEST: Click 'Portfolio' in the sidebar menu or navigate to /portfolio. Verify you land on the tree view page with title "Vue Arborescente" and subtitle "Navigation hi√©rarchique de votre portefeuille immobilier".

STATISTICS DISPLAY TEST: At the top of the page, verify 5 gradient statistic cards display with real counts: 1) Sites (should show 13 for Organization 1), 2) B√¢timents (total buildings count), 3) Niveaux (total levels count), 4) Espaces (total spaces count), 5) √âquipements (total equipment count). Each card has distinct gradient colors.

ORGANIZATION ROOT TEST: Verify tree starts with organization root node displaying organization name with briefcase icon in purple gradient header. Shows total sites count in parentheses.

HIERARCHY DISPLAY TEST: Verify complete 6-level hierarchy displays: 1) Organization (root), 2) Sites (blue building icon), 3) Buildings (pink building icon, nested under sites), 4) Levels (cyan layers icon, nested under buildings, ordered by level_number), 5) Spaces (green house icon, nested under levels), 6) Equipment (yellow gear icon, nested under spaces, leaf nodes).

EXPAND/COLLAPSE FUNCTIONALITY TEST: Click on any node with children (shows chevron-right icon). Verify: 1) Children div becomes visible (display: block), 2) Chevron icon rotates 90 degrees downward, 3) Background color changes on hover. Click again to collapse: children hide (display: none), chevron rotates back to right. Test expanding multiple levels simultaneously: Site > Building > Level > Space > Equipment.

ICONS AND BADGES TEST: Verify each level has distinct icon and color: Sites (blue building), Buildings (pink building), Levels (cyan layers), Spaces (green house), Equipment (yellow gear). Verify site type badges display (e.g., "Bureau", "Commercial"). Verify space type badges when present. Verify counts display next to each node showing number of children.

LINKS TEST: Click on any node name (not the expand icon). Verify redirects to corresponding detail page: site_path(site), building_path(building), level_path(level), space_path(space), equipment_path(equipment). Verify links are styled properly (no underline, dark gray color).

EMPTY STATE TEST: Login as a user with no sites (or manually remove all sites temporarily). Navigate to /portfolio. Verify empty state displays: large building icon (opacity 0.3), heading "Aucun site disponible", message with link "Commencez par cr√©er votre premier site" linking to /sites/new.

VISUAL HIERARCHY TEST: Verify indentation increases at each level (margin-left: var(--space-xl)). Verify icon sizes decrease progressively (24px > 20px > 18px > 16px > 14px > 12px). Verify font sizes decrease for deeper levels. Verify leaf nodes (equipment) have no expand icon, just spacing div.

CONTROLLER INTEGRATION TEST: Verify tree_controller.js Stimulus controller is attached (data-controller="tree"). Verify toggle action works (data-action="click->tree#toggle"). Verify targets work correctly (data-tree-target="node", "children", "icon").

HELP TEXT TEST: At bottom of page, verify blue info box with lightbulb emoji displays tip: "Cliquez sur les ic√¥nes de fl√®che pour d√©velopper/r√©duire les niveaux de la hi√©rarchie. Cliquez sur les noms pour acc√©der aux pages de d√©tail."

ORGANIZATION ISOLATION TEST: Login as portfolio@hubsight.com - verify sees 13 sites from Organization 1. Logout, login as portfolio2@hubsight.com - verify sees 12 sites from Organization 2 only, completely different tree structure. Verify no data leakage between organizations.

PERFORMANCE TEST: With full hierarchy of sites/buildings/levels/spaces/equipment, verify tree loads efficiently. Verify expand/collapse is instant with no lag. Verify initial page load shows all nodes collapsed except organization root.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">19</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Import OmniClass Table 23<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Import OmniClass Table 23 equipment classification (256 equipment types) from Excel file provided by client</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col">PREREQUISITES: Database must be migrated and seeded. Run `bin/rails db:migrate` and `bin/rails db:seed` to ensure equipment_types table exists with seed data.

DATABASE VERIFICATION: Open Rails console (`bin/rails console`) and verify: 1) EquipmentType model exists: `EquipmentType.count` should return 68 (representative sample of 256 types). 2) Check technical lots distribution: `EquipmentType.group(:technical_lot_trigram).count` should show counts for CVC (20), ELE (11), PLO (10), SEC (15), ASC (5), CEA (3), CTE (2), AUT (2). 3) Verify data structure: `EquipmentType.first` should display all fields including code, equipment_type_name, technical_lot_trigram, technical_lot, purchase_subfamily, function, omniclass_number, omniclass_title, 10 characteristic fields, status, timestamps.

EQUIPMENT TYPE MODEL TEST: In Rails console, test model validations and associations: 1) `et = EquipmentType.find_by(code: 'CVC-001')` - verify finds "Chaudi√®re gaz murale". 2) Test associations: `et.equipment` should return associated equipment (may be empty initially). 3) Test scopes: `EquipmentType.active` (all active types), `EquipmentType.by_technical_lot('CVC')` (20 HVAC types), `EquipmentType.by_subfamily('CHAUFFAGE')` (heating types), `EquipmentType.search('climatiseur')` (search functionality). 4) Test helper methods: `et.technical_lot_name` returns full French name, `et.display_name` returns "CODE - Name" format, `et.lot_badge_color` returns color for UI badges, `et.characteristics` returns array of non-nil characteristics.

EQUIPMENT LINKING TEST: Verify equipment can link to equipment types: 1) In console: `equipment = Equipment.first`, `equipment.equipment_type_id = EquipmentType.find_by(code: 'CVC-007').id`, `equipment.save!` 2) Verify association: `equipment.equipment_type` returns EquipmentType object. 3) Reverse association: `EquipmentType.find_by(code: 'CVC-007').equipment` returns equipment with that type. 4) Check database: `Equipment.where.not(equipment_type_id: nil).count` shows linked equipment (6 from seed data).

SEED DATA VERIFICATION: Check that seed data loaded correctly: 1) CVC types (20): boilers (CVC-001 to CVC-003), heat pumps (CVC-004, CVC-005), chillers/AC (CVC-006 to CVC-009), ventilation (CVC-010 to CVC-013), distribution (CVC-014 to CVC-020). 2) ELE types (11): electrical distribution (ELE-001 to ELE-004), lighting (ELE-005 to ELE-008), power supply (ELE-009 to ELE-011). 3) PLO types (10): water distribution (PLO-001 to PLO-005), drainage (PLO-006 to PLO-008), fixtures (PLO-009 to PLO-010). 4) SEC types (15): fire detection (SEC-001 to SEC-004), fire suppression (SEC-005 to SEC-007), access control (SEC-008 to SEC-010), video surveillance (SEC-011 to SEC-013), intrusion detection (SEC-014 to SEC-015). 5) ASC types (5): elevators (ASC-001 to ASC-005). 6) CEA types (3): architectural elements (CEA-001 to CEA-003). 7) CTE types (2): technical control (CTE-001 to CTE-002). 8) AUT types (2): automation/BMS (AUT-001 to AUT-002).

OMNICLASS CODES VERIFICATION: Verify OmniClass Table 23 codes are properly structured: 1) Check format "XX-XX XX XX" (e.g., "23-33 11 11" for Gas Boilers). 2) Verify codes follow international BIM classification standard. 3) Sample codes to verify: CVC boilers start with "23-33", electrical with "23-43" or "23-49", plumbing with "23-21" or "23-51", security with "25-71", "25-81", etc.

TECHNICAL LOTS CONSTANTS TEST: In console, verify EquipmentType::TECHNICAL_LOTS constant exists with 9 lots: CEA, CVC, ELE, PLO, SEC, ASC, CTE, AUT, DIV with French descriptions. Verify EquipmentType::PURCHASE_SUBFAMILIES constant exists with 20 subfamilies.

FUTURE ADMIN INTERFACE PREPARATION: While admin UI isn't implemented yet, verify groundwork is ready: 1) Model has all necessary validations. 2) Scopes for filtering exist (by_technical_lot, by_subfamily, by_function, search, ordered). 3) Helper methods for display (display_name, full_classification, lot_badge_color). 4) Equipment association is optional (equipment_type_id nullable) maintaining backward compatibility with legacy string equipment_type field.

STATUS VERIFICATION: All equipment types should have status='active'. Test: `EquipmentType.where(status: 'inactive').count` should return 0. `EquipmentType.active.count` should return 68.

NOTE: Current implementation has 68 representative types as proof of concept. Full implementation would require importing all 256 types from client's Excel file. The database schema and model support full 256 types with all fields (10 customizable characteristics per type).</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">20</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Import Space Structure<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Import space structure including OmniClass Table 13 space classifications (966 types) from Excel file</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col">PREREQUISITES: Database must be migrated and seeded. Run `bin/rails db:migrate` and `bin/rails db:seed` to ensure omniclass_spaces table exists with seed data.

DATABASE VERIFICATION: Open Rails console (`bin/rails console`) and verify: 1) OmniclassSpace model exists: `OmniclassSpace.count` should return 127 (representative sample of 966 classifications). 2) Check major categories: `OmniclassSpace.where("code LIKE ?", "13-__ 00 00").count` should show 7+ major categories (Outdoor, Building, Healthcare, Residential, Commercial, Industrial, Transportation). 3) Verify data structure: `OmniclassSpace.first` should display all fields including code, title, additional_data_1, additional_data_2, status, timestamps.

OMNICLASS SPACE MODEL TEST: In Rails console, test model validations and scopes: 1) `os = OmniclassSpace.find_by(code: '13-21 11 11')` - verify finds "Private Offices". 2) Test scopes: `OmniclassSpace.active` (all active classifications), `OmniclassSpace.by_category('13-21 11')` (office-related classifications), `OmniclassSpace.search('office')` (search functionality). 3) Test helper methods: `os.display_name` returns "code - title" format, `os.category_level` returns hierarchy level (1-4), `os.major_category` returns "13", `os.category_badge_color` returns UI color.

SPACE INTEGRATION TEST: Verify Space model can reference classifications: 1) In console: `space = Space.first` 2) Set OmniClass code: `space.update(omniclass_code: '13-21 11 11')` 3) Test association: `space.omniclass_classification` returns OmniclassSpace object. 4) Test helpers: `space.omniclass_title` returns classification title, `space.omniclass_display` returns formatted display "code - title".

SEED DATA VERIFICATION: Check that seed data loaded correctly: 1) Outdoor Spaces (13-11): parking lots, recreation areas, plazas, gardens, loading docks. 2) Building Spaces (13-21): offices (private, open, cubicle), conference rooms, meeting rooms, educational spaces, support spaces, break rooms, reception areas. 3) Healthcare Spaces (13-31): patient rooms, ICU, examination rooms, operating rooms, radiology. 4) Residential Spaces (13-41): living rooms, bedrooms, kitchens, bathrooms. 5) Commercial Spaces (13-51): retail sales, restaurants, entertainment. 6) Industrial Spaces (13-61): manufacturing, warehouses. 7) Transportation Spaces (13-71): ticket counters, baggage claim, waiting areas. 8) Technical/Service Spaces (13-91): mechanical rooms, electrical rooms, telecom rooms, janitorial. 9) Circulation Spaces (13-95): corridors, hallways, stairs, elevators. 10) Sanitary Facilities (13-97): restrooms, locker rooms.

OMNICLASS CODES VERIFICATION: Verify OmniClass Table 13 codes are properly structured: 1) Check format "13-XX YY ZZ" (e.g., "13-21 11 11" for Private Offices). 2) Verify codes follow international BIM classification standard. 3) Sample codes to verify: Building spaces start with "13-21", Healthcare with "13-31", Residential with "13-41", Commercial with "13-51", etc.

HIERARCHY TESTING: Test hierarchical helper methods: 1) `classification = OmniclassSpace.find_by(code: '13-21 11 11')` 2) Test `classification.category_level` returns correct depth (3 for this code). 3) Test `classification.parent_code` returns parent "13-21 11 00". 4) Test `classification.major_category` returns "13".

SEARCH AND FILTER TEST: Test search and filtering capabilities: 1) `OmniclassSpace.search('office').count` should return 6+ results. 2) `OmniclassSpace.by_category('13-21').count` should return 25+ building-related classifications. 3) `OmniclassSpace.by_category('13-91').count` should return 8+ technical/service classifications.

STATUS VERIFICATION: All classifications should have status='active'. Test: `OmniclassSpace.where(status: 'inactive').count` should return 0. `OmniclassSpace.active.count` should return 127.

FUTURE ADMIN INTERFACE PREPARATION: While admin UI isn't implemented yet, verify groundwork is ready: 1) Model has all necessary validations. 2) Scopes for filtering exist (active, by_category, search, ordered). 3) Helper methods for display (display_name, category_level, category_badge_color). 4) Space association works via omniclass_code string field (flexible, allows codes not in database).

NOTE: Current implementation has 127 representative classifications as proof of concept. Full implementation would require importing all 966 classifications from client's Excel file (Espaces.xlsx, Sheet 8: OmniClass Table 13). The database schema and model support full 966 classifications. See doc/implementation_plan_item_20.md for complete documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">21</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Import Contract Families<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Import contract families and subfamilies (7 families + 20+ subfamilies) from Excel file provided by client</td>
                    <td class="url-col">bin/rails console</td>
                    <td class="test-col">PREREQUISITES: Database must be migrated and seeded. Run `bin/rails db:migrate` and `bin/rails db:seed` to ensure contract_families table exists with seed data.

DATABASE VERIFICATION: Open Rails console (`bin/rails console`) and verify: 1) ContractFamily model exists: `ContractFamily.count` should return 42 (7 families + 35 subfamilies). 2) Check families count: `ContractFamily.families_only.count` should return 7. 3) Check subfamilies count: `ContractFamily.subfamilies_only.count` should return 35. 4) Verify data structure: `ContractFamily.first` should display all fields including code, name, family_type, parent_code, description, status, display_order, timestamps.

CONTRACT FAMILY MODEL TEST: In Rails console, test model validations and scopes: 1) `family = ContractFamily.find_by(code: 'MAIN')` - verify finds "Maintenance" family. 2) Test scopes: `ContractFamily.active` (all active classifications), `ContractFamily.families` (7 families), `ContractFamily.by_family('MAIN')` (subfamilies of Maintenance), `ContractFamily.search('CVC')` (search functionality). 3) Test helper methods: `family.display_name` returns "MAIN - Maintenance", `family.is_family?` returns true, `family.subfamilies.count` returns 7, `family.family_badge_color` returns UI color.

SUBFAMILY TESTING: In Rails console, test subfamily methods: 1) `subfamily = ContractFamily.find_by(code: 'MAIN-CVC')` - verify finds "CVC (Chauffage, Ventilation, Climatisation)". 2) Test methods: `subfamily.is_subfamily?` returns true, `subfamily.parent_code` returns "MAIN", `subfamily.parent_family` returns Maintenance family object, `subfamily.hierarchy_path` returns "Maintenance > CVC (Chauffage, Ventilation, Climatisation)", `subfamily.display_name` returns "MAIN-CVC - CVC (Chauffage, Ventilation, Climatisation)".

SEED DATA VERIFICATION: Check that all 7 families loaded correctly: 1) MAIN (Maintenance) with 7 subfamilies: Ascenseurs, CVC, Plomberie, √âlectricit√©, Menuiseries, Fa√ßades, Toitures. 2) NETT (Nettoyage et Hygi√®ne) with 5 subfamilies: Nettoyage locaux, Espaces verts, D√©ratisation, Gestion d√©chets, Nettoyage vitres. 3) CTRL (Contr√¥les Techniques et Biologiques) with 6 subfamilies: Contr√¥les r√©glementaires, V√©rifications √©lectriques, Appareils levage, S√©curit√© incendie, Analyse l√©gionelles, Qualit√© air. 4) FLUI (Fluides) with 5 subfamilies: √âlectricit√©, Gaz, Eau potable, Eau glac√©e, Fioul. 5) ASSU (Assurances) with 4 subfamilies: Multirisque, Responsabilit√© civile, Dommages biens, Perte exploitation. 6) IMMO (Immobilier) with 4 subfamilies: Gestion copropri√©t√©, Gestion locative, Administration biens, Taxes fonci√®res. 7) AUTR (Autres Contrats) with 4 subfamilies: S√©curit√©, T√©l√©phonie, Internet, Gestion parking.

HIERARCHY TESTING: Test hierarchical navigation: 1) `ContractFamily.families.each { |f| puts "#{f.code}: #{f.name} (#{f.subfamilies.count} subfamilies)" }` should list all 7 families with correct subfamily counts. 2) `ContractFamily.grouped_by_family` should return hash with families as keys and subfamilies arrays as values. 3) Verify subfamilies correctly reference parents via parent_code field.

CONTRACT INTEGRATION TEST: Verify Contract model integration: 1) `contract = Contract.first`. 2) Test methods: `contract.contract_family_object` returns ContractFamily if match found, `contract.family_display_name` returns formatted string, `contract.family_hierarchy` returns hierarchy path, `contract.has_family_classification?` returns boolean. 3) Note: Current contracts may not have matching classifications yet as they use different naming convention ("Maintenance CVC" vs "MAIN-CVC").

SEARCH AND FILTER TEST: Test search and filtering capabilities: 1) `ContractFamily.search('maintenance').count` should return results matching "maintenance" in code or name. 2) `ContractFamily.search('CVC').count` should return 1 (MAIN-CVC subfamily). 3) `ContractFamily.by_family('MAIN').count` should return 7 (Maintenance subfamilies). 4) `ContractFamily.active.count` should return 42 (all classifications active).

STATUS VERIFICATION: All classifications should have status='active'. Test: `ContractFamily.where(status: 'inactive').count` should return 0. `ContractFamily.active.count` should return 42.

DISPLAY ORDER TEST: Verify display_order field exists and families are ordered correctly: `ContractFamily.families.pluck(:code, :display_order)` should show families ordered from 1 to 7.

NOTE: Current implementation has 42 classifications (7 families + 35 subfamilies) as proof of concept. System supports unlimited expansion with additional subfamilies as client data becomes available. See doc/implementation_plan_item_21.md for complete documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">22</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Equipment Search & Autocomplete<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Search and autocomplete system in equipment database to facilitate manual entry, with filtering by technical lot and function</td>
                    <td class="url-col"><a href="/equipment/new">/equipment/new</a> or <a href="/equipment/1/edit">/equipment/:id/edit</a></td>
                    <td class="test-col">PREREQUISITES: Task 19 (Equipment Types) must be completed. Database must be seeded with equipment types. Login as portfolio manager (portfolio@hubsight.com / Password123!).

BASIC SEARCH TEST: Navigate to /equipment/new or edit an existing equipment (/equipment/:id/edit). Locate "Type d'√âquipement" field with autocomplete. Type "clim" (at least 2 characters). Verify loading spinner appears briefly. After 300ms, verify dropdown appears with matching equipment types (climatiseurs). Verify each result shows: CVC badge (blue), equipment code (e.g., CVC-007), equipment name, function/subfamily info. Click on a result. Verify: input field populated with selected type (e.g., "CVC-007 - Climatiseur split mural"), hidden field contains equipment_type_id, detailed info panel displays below showing technical lot, function, subfamily, OmniClass code, characteristics.

TECHNICAL LOT FILTERING TEST: Click "CVC" filter button above search field. Verify button becomes highlighted (blue background, white text). Type "ch" in search. Verify only CVC equipment types shown (chaudi√®res, etc.). Click "ELE" button. Verify filter switches - button highlighted, only electrical equipment shown. Click "ELE" again. Verify filter deactivated - button returns to normal, all types shown. Test all 8 filter buttons (CVC, ELE, PLO, SEC, ASC, CEA, CTE, AUT).

KEYBOARD NAVIGATION TEST: Type search query to show results dropdown. Press Arrow Down key multiple times. Verify selection highlight moves down through results. Press Arrow Up key. Verify selection moves up. Verify selected item scrolls into view if needed. Press Enter key. Verify highlighted item is selected and form updated. Press Escape key. Verify dropdown closes.

MULTIPLE FILTERS TEST: Type "d√©tecteur" in search. Verify both fire and security detectors appear. Click "SEC" filter button. Verify only security detectors shown (SEC badge, red). Clear search and type "pompe". Click "PLO" filter button. Verify only plumbing pumps shown (PLO badge, cyan).

VISUAL ELEMENTS TEST: Verify badge colors match technical lots: CVC=Blue (#3b82f6), ELE=Yellow (#f59e0b), PLO=Cyan (#06b6d4), SEC=Red (#ef4444), ASC=Purple (#a855f7), CEA=Green (#10b981), CTE=Orange (#f97316), AUT=Indigo (#6366f1). Verify loading spinner appears during API call (spinning circle icon). Verify selected equipment info panel displays with gradient background, color-coded badge, complete details (function, subfamily, OmniClass, characteristics).

EDGE CASES TEST: Type single character "c". Verify no dropdown appears (minimum 2 chars required). Type "zzzzzzz" (non-existent). Verify "Aucun type d'√©quipement trouv√©" message with helpful text. Click outside dropdown. Verify dropdown closes. Start typing, then clear input. Verify dropdown hides.

DEBOUNCING TEST: Type rapidly "climatiseur". Verify only ONE API call made after 300ms pause (check browser Network tab). Verify no excessive API calls during typing.

API ENDPOINT TEST: Open browser DevTools Network tab. Type search query. Verify API call to /api/equipment_types/autocomplete with correct parameters (query, technical_lot if filter active). Verify response contains JSON array with equipment types including: id, code, name, display_name, technical_lot_trigram, technical_lot_name, function, omniclass_number, characteristics, lot_badge_color. Verify response limited to 50 results max.

FORM INTEGRATION TEST: Select an equipment type via autocomplete. Fill rest of form (name, manufacturer, etc.). Submit form. Verify equipment created with correct equipment_type_id. View created equipment. Verify equipment type displayed correctly. Edit equipment. Verify autocomplete pre-populated with current equipment type.

ORGANIZATION ISOLATION TEST: Login as portfolio@hubsight.com. Use autocomplete - verify sees all 68 equipment types. Logout, login as portfolio2@hubsight.com. Verify sees same equipment types (shared reference data, not org-scoped).

PERFORMANCE TEST: With all 68 equipment types in database, verify autocomplete responds within 500ms. Verify dropdown renders smoothly with no lag. Verify keyboard navigation is instant. Verify no console errors.

NOTE: Equipment types are reference data (OmniClass Table 23 classifications) shared across organizations. The actual equipment instances are organization-scoped. See doc/implementation_plan_item_22.md for complete technical documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">23</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Link Equipment to OmniClass<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Manual linking interface for associating equipment with OmniClass classification codes via search system</td>
                    <td class="url-col"><a href="/equipment/new">/equipment/new</a> or <a href="/equipment/1/edit">/equipment/:id/edit</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Go to a space (e.g., /spaces/1), click "Nouvel √âquipement". In "Type d'√âquipement" field, type "clim" (min 2 chars). Verify autocomplete dropdown appears with CVC badge (blue). Click "CVC" filter button - verify shows only CVC types. Select "CVC-007 - Climatiseur split mural". Verify selected info panel displays with: technical lot badge, equipment name/code, function, OmniClass code (23-35 17 13), purchase subfamily, characteristics. Verify hidden field has equipment_type_id. Fill name "Climatiseur Daikin" and manufacturer "Daikin". Submit form. Verify equipment created. On show page (/equipment/:id), verify displays: Type "Climatiseur split mural" with CVC badge (blue), OmniClass "23-35 17 13 (Split System Air Conditioners)", Sous-domaine "CVC - CLIMATISATION". Test edit: click "√âditer", verify autocomplete pre-populated. Change type by searching "chaud", select "CVC-001 - Chaudi√®re gaz murale". Submit. Verify show page updates with new OmniClass. Test keyboard: type search, use Arrow Down/Up to navigate, Enter to select, Escape to close. Test filters: click each of 8 buttons (CVC, ELE, PLO, SEC, ASC, CEA, CTE, AUT), verify filtering works. Test debouncing: type rapidly "climatiseur" in DevTools Network tab, verify only 1 API call after 300ms. Test nil handling: view equipment without equipment_type_id, verify shows "Non sp√©cifi√©" gracefully.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">24</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Upload PDF Contracts<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Upload multi-page PDF contract documents with progress indicator and file validation (max size, file type)</td>
                    <td class="url-col"><a href="/contracts/new">/contracts/new</a></td>
                    <td class="test-col">Navigate to http://localhost:3000/contracts/new. Scroll to "üìÑ Document PDF du Contrat" section (orange/yellow gradient background). TEST DRAG & DROP: Drag a PDF file (under 10MB) over the upload zone - verify zone changes color with visual feedback. Drop the file - verify file preview appears showing filename and size. TEST CLICK UPLOAD: Click orange "S√©lectionner un fichier" button - verify file picker opens. Select a PDF - verify preview appears. TEST VALIDATION (Wrong Type): Try uploading .jpg/.docx/.txt - verify error "Le fichier doit √™tre au format PDF" appears and file rejected. TEST VALIDATION (Too Large): Try uploading PDF >10MB - verify error "Le fichier ne doit pas d√©passer 10 Mo" appears. TEST REMOVE: Upload valid PDF, click X button on preview - verify preview disappears. TEST COMPLETE SUBMISSION: Fill required contract fields (Type: "Contrat initial", Num√©ro: "TEST-2024-001", Titre: "Test Upload", Type de Contrat, Famille d'Achats, Montant Annuel HT: "10000", dates). Upload valid PDF. Click "Cr√©er le Contrat". Verify contract created with PDF attached. TEST VIEW/DOWNLOAD: Navigate to edit page, scroll to PDF section. Verify "PDF Actuel" section shows with green background, filename, size. Click "Voir" - verify PDF opens in new tab. Click "T√©l√©charger" - verify PDF downloads. TEST REPLACE: Upload different PDF on edit page, save - verify new PDF replaces old one. Verify button styling matches app design (rounded borders, proper padding, 3.315rem height). See doc/implementation_plan_item_24.md for complete test steps.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">25</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - OCR Text Extraction (Mistral)<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Integrate Mistral OCR API for text extraction from uploaded PDF documents (~‚Ç¨0.10/contract cost)</td>
                    <td class="url-col"><a href="/contracts/:id">/contracts/:id</a> (see OCR status section)</td>
                    <td class="test-col">PREREQUISITES: Task 24 (PDF Upload) must be completed. Run `bin/rails db:migrate` to ensure OCR fields exist. Login as portfolio manager (portfolio@hubsight.com / Password123!). CREATE CONTRACT WITH PDF: Go to /contracts/new, fill required fields, upload a digital PDF (Word export, etc.), submit. View contract show page - scroll to "Extraction OCR du PDF" section. VERIFY AUTO-TRIGGER: OCR should auto-trigger in background. Refresh page after a few seconds. STATUS DISPLAY: Verify status badge shows "Termin√©" (green) for success or "En attente" (yellow) for pending. Verify provider shows "PDF Reader (Gratuit)" (FREE). VIEW EXTRACTED TEXT: If completed, click "Voir le texte extrait" - verify text was extracted correctly. RETRY FEATURE: For failed extractions, verify "üîÑ Relancer l'extraction" button appears. Click it to manually retry. CONSOLE TEST: Run `bin/rails console`, then `ExtractContractOcrJob.perform_now(Contract.last.id)` to manually trigger. Check `Contract.last.ocr_status` should be "completed", `Contract.last.ocr_text` should contain extracted text. MISTRAL MIGRATION: System ready for Mistral - when API key added to credentials, automatically switches from pdf-reader to Mistral with zero code changes. See doc/implementation_plan_item_25.md for complete documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">26</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - LLM Data Structuring (OpenRouter)<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Automatic data extraction via LLM (OpenRouter): contract number, dates, type, provider, durations, renewal, equipment, amounts (72 fields)</td>
                    <td class="url-col"><a href="/contracts/:id">/contracts/:id</a> (scroll to "Donn√©es Extraites Automatiquement" section)</td>
                    <td class="test-col">PREREQUISITES: Task 25 (OCR) must be completed. Run `bin/rails db:migrate` to ensure LLM fields exist. Login as portfolio manager (portfolio@hubsight.com / Password123!). CREATE CONTRACT WITH PDF: Go to /contracts/new, fill required fields, upload a contract PDF, submit. View contract show page. VERIFY AUTO-WORKFLOW: OCR triggers first (see "Extraction OCR du PDF" section), then LLM extraction auto-triggers when OCR completes (see "Donn√©es Extraites Automatiquement" section). Refresh page after ~10s. DEMO MODE VERIFICATION: Verify üé≠ "Mode D√©monstration" banner displays with orange gradient background explaining FREE regex extraction. Verify extraction metadata shows: Fournisseur "Mock", Mod√®le "Mock Provider (Regex)", Confiance "XX%", Trait√© le timestamp. VIEW 72 EXTRACTED FIELDS: Verify 6 collapsible sections display: üìã Identification (8 fields) - contract number, title, type, subfamily, etc.; üë• Parties Prenantes (10 fields) - organizations, contacts, emails, phones; üéØ P√©rim√®tre (15 fields) - sites, buildings, equipment types, counts; üí∞ Aspects Financiers (15 fields) - amounts, billing, payment, revisions; üìÖ Temporalit√© (10 fields) - dates, durations, renewals; üîß Services & SLA (12 fields) - nature, frequencies, delays, KPIs. Click section headers to expand/collapse. FIELD DISPLAY: Verify fields with extracted data show GREEN background (#f0fdf4). Verify fields without data show RED background (#fef2f2) with "‚Äî". Verify proper formatting: dates (DD/MM/YYYY), currency (‚Ç¨), booleans (Oui/Non), percentages (XX%). RETRY TEST: If extraction fails, verify "üîÑ Relancer l'extraction" button appears. Click to manually retry. CONSOLE TEST: Run `ExtractContractDataJob.perform_now(Contract.last.id)` to manually trigger. Check `Contract.last.extraction_status` should be "completed", verify all 72 fields populated. UPGRADE TO REAL LLM (Optional): Add OpenRouter API key to Rails credentials: `EDITOR="code --wait" bin/rails credentials:edit`, add `openrouter: {api_key: sk-or-v1-YOUR-KEY}`. Restart server. Upload new PDF. Verify banner changes from üé≠ Demo to ‚úÖ real LLM, Model shows "anthropic/claude-3.5-sonnet", Confidence ~85-95%. See doc/implementation_plan_item_26.md for complete documentation and upgrade instructions.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">27</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Validate Extracted Data<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Manual validation interface showing extracted data side-by-side with PDF, allowing corrections and confirmations before saving</td>
                    <td class="url-col"><a href="/contracts/:id/validate">/contracts/:id/validate</a></td>
                    <td class="test-col">PREREQUISITES: Task 26 (LLM Data Structuring) must be completed. Login as portfolio manager (portfolio@hubsight.com / Password123!). CREATE CONTRACT WITH PDF: Go to /contracts/new, fill required fields, upload a contract PDF, submit. View contract show page - wait for OCR and LLM extraction to complete (refresh page). NAVIGATE TO VALIDATION: On contract show page, scroll to "Donn√©es Extraites Automatiquement" section. Click "Valider les Donn√©es" button - verify redirects to /contracts/:id/validate. SPLIT-SCREEN LAYOUT: Verify page displays split-screen layout: LEFT side shows embedded PDF viewer with contract document in iframe, sticky positioned. RIGHT side shows editable validation form scrolling independently. VALIDATION BANNER: Verify purple gradient banner at top: "‚úì Validation Manuelle Requise" with explanation text. FORM STRUCTURE: Verify 6 collapsible sections with field counts: üìã Identification (8 fields), üë• Parties Prenantes (10 fields), üéØ P√©rim√®tre (8 fields), üí∞ Aspects Financiers (10 fields), üìÖ Temporalit√© (8 fields), üîß Services & SLA (8 fields). Click section headers to expand/collapse. VISUAL INDICATORS: Verify fields with extracted data show GREEN background (#f0fdf4) with green border. Verify empty fields show RED background (#fef2f2) with red border. FIELD EDITING: Expand "Identification" section - edit "Titre" field, change text. Expand "Parties Prenantes" - update contractor name, email. Expand "Aspects Financiers" - modify amounts. Verify all fields are editable (text inputs, textareas, number inputs, date pickers, selects for booleans). VALIDATION NOTES: Scroll to bottom - verify "Notes de validation" textarea for optional comments. SUBMIT VALIDATION: Fill validation notes "Donn√©es v√©rifi√©es et corrig√©es". Click "‚úì Valider le Contrat" green button. Verify success message "Contrat valid√© avec succ√®s." Verify redirect to contract show page (/contracts/:id). VERIFY UPDATES: On show page, verify corrected fields display updated values. Verify validation status badge shows "Valid√©" (green). Verify "Valid√© par" shows your name with timestamp. TEST AUTHORIZATION: Logout, login as different organization portfolio manager. Try accessing /contracts/:id/validate for another org's contract - verify redirected with error "Acc√®s non autoris√©." TEST EXTRACTION CHECK: Create contract without PDF or with failed extraction. Try accessing /contracts/:id/validate - verify redirected with error "L'extraction des donn√©es doit √™tre termin√©e avant la validation." TEST CANCEL: Start validation, make edits, click "Annuler" button - verify returns to contract show page without saving changes. PDF VIEWER: Verify PDF displays correctly in left panel iframe. Verify scrolling works independently from form. If no PDF attached, verify empty state message displays. TEST MOBILE: Reduce browser width - verify layout remains functional (may stack vertically on very small screens). See doc/implementation_plan_item_27.md for complete documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">28</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Manual Contract Creation<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Create contracts manually when no document exists or extraction is incomplete, with comprehensive form for all 72 contract fields</td>
                    <td class="url-col"><a href="/contracts/new">/contracts/new</a> or <a href="/contracts/:id/edit">/contracts/:id/edit</a></td>
                    <td class="test-col">PREREQUISITES: Tasks 24-27 (PDF Upload, OCR, LLM, Validation) must be completed for full workflow understanding. Login as portfolio manager (portfolio@hubsight.com / Password123!). MANUAL CREATION TEST (No PDF): Navigate to /contracts/new. Verify purple gradient banner displays: "üìù M√©thode de Cr√©ation du Contrat" explaining two creation methods (PDF upload OR manual entry). Verify orange/yellow gradient "Document PDF du Contrat" section shows with "(Optionnel)" label and orange "S√©lectionner un fichier" button. SKIP PDF - scroll past it. Verify 6 collapsible sections appear: üìã Identification (8 fields), üë• Parties Prenantes (10 fields), üéØ P√©rim√®tre (15 fields), üí∞ Aspects Financiers (15 fields), üìÖ Temporalit√© (10 fields), üîß Services & SLA (12 fields). Click section headers to expand/collapse - verify smooth toggle with proper styling. FILL REQUIRED FIELDS (only 5): Expand "Identification" section. Fill "Num√©ro de Contrat" (e.g., "MAN-2024-001"), "Titre du Contrat" (e.g., "Test Manual Creation"), select "Type de Contrat" from dropdown (10 options), fill "Objet du Contrat" textarea (e.g., "Testing manual contract creation without PDF"). Expand "Parties Prenantes" section. Fill "Prestataire (Organisation)" (e.g., "ENGIE Solutions"). Red asterisks (*) mark all required fields. FILL OPTIONAL FIELDS: Expand other sections and test filling various field types: text inputs (purchase_subfamily, contracting_method), textareas (detailed_description, covered_sites), number inputs (annual_amount_ht, equipment_count), date inputs (signature_date, execution_start_date), select dropdowns (billing_method, billing_frequency, automatic_renewal), boolean selects (on_call_24_7, spare_parts_included). Verify all 72 fields accessible and editable. SUBMIT WITHOUT PDF: Scroll to bottom, click green "Cr√©er le Contrat" button. Verify success message "Contrat cr√©√© avec succ√®s." Verify redirect to contract show page (/contracts/:id). VIEW CREATED CONTRACT: On show page, verify all manually entered data displays correctly. Scroll to "Extraction OCR du PDF" section - verify shows "Aucun PDF attach√©" message (not error). Scroll to "Donn√©es Extraites Automatiquement" section - verify shows "Aucune extraction disponible" message (no OCR/LLM triggered without PDF). Verify contract is fully functional without PDF. HYBRID TEST (PDF + Manual): Create new contract at /contracts/new. Upload a PDF in the optional section. Wait for OCR/LLM extraction to complete (~10s). Navigate to edit page (/contracts/:id/edit). Verify form pre-populated with extracted data AND allows manual editing. Expand "P√©rim√®tre" section - manually fill "Zones G√©ographiques", "Noms des B√¢timents" fields that LLM might have missed. Expand "Services & SLA" - manually add "KPIs" details. Click "Mettre √† Jour le Contrat". Verify both extracted AND manually entered data persist correctly. VALIDATION TESTS: Try creating contract WITHOUT required fields - click submit. Verify HTML5 validation prevents submission with messages "Please fill out this field." Fill only 4 of 5 required fields - verify validation catches missing field. Fill contract_number with existing number - verify uniqueness validation (if implemented). FIELD TYPE TESTS: Test number fields accept only numbers (annual_amount_ht, monthly_amount, equipment_count). Test date fields open date picker. Test select fields show all options (contract_type has 10, billing_method has 3, etc.). Test textareas expand vertically as text entered. VISUAL TESTS: Verify 2-column responsive grid layout. Verify proper spacing between fields (var(--space-lg)). Verify field labels bold with proper margin. Verify placeholder text provides helpful examples. Verify required field asterisks (*) are red (var(--coral-primary)). Verify collapsible section headers have gradient backgrounds, proper padding, hover effects. Verify section icons display (üìã üë• üéØ üí∞ üìÖ üîß). EDIT TEST: From contract show page, click "√âditer" button. Verify /contracts/:id/edit uses same comprehensive form. Verify all existing values pre-populated correctly. Modify several fields across different sections. Submit - verify updates save correctly. ORGANIZATION ISOLATION: Login as portfolio@hubsight.com - create contract. Logout, login as portfolio2@hubsight.com - verify cannot see/edit Organization 1's contract. Create contract for Organization 2 - verify completely isolated data. CANCEL TEST: Click "Annuler" button on new/edit pages - verify returns to /contracts without saving. BROWSER COMPATIBILITY: Test in Chrome, Firefox, Safari - verify form renders correctly. Test responsive behavior - resize window, verify form adapts (may stack columns on mobile). See doc/implementation_plan_item_28.md for complete documentation of all 72 fields and technical details.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">29</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Contract Family Search</td>
                    <td class="description-col">Search and autocomplete system in contract family/subfamily database to facilitate manual linking during contract entry</td>
                    <td class="url-col"><a href="/contracts/new">/contracts/new</a> or <a href="/contracts/1/edit">/contracts/:id/edit</a></td>
                    <td class="test-col">PREREQUISITES: Task 21 (Contract Families) must be completed. Database must be seeded with contract families. Login as portfolio manager (portfolio@hubsight.com / Password123!). BASIC SEARCH TEST: Navigate to /contracts/new or edit an existing contract (/contracts/:id/edit). In "Identification du Contrat" section (4th field), locate "Famille d'Achats" field with autocomplete. Verify 7 filter buttons display above input (MAIN-blue, NETT-green, CTRL-yellow, FLUI-purple, ASSU-red, IMMO-indigo, AUTR-gray). Type "main" (at least 2 characters). Verify loading spinner appears briefly. After 300ms, verify dropdown appears with matching contract families. Verify each result shows: family badge (colored), family code (e.g., MAIN-CVC), family name, hierarchy path. Click on a result "MAIN-CVC - CVC (Chauffage, Ventilation, Climatisation)". Verify: input field populated with display name, hidden field contains code "MAIN-CVC", subfamily field auto-populated with "CVC (Chauffage, Ventilation, Climatisation)", selected info panel displays below showing full hierarchy "Maintenance > CVC (Chauffage, Ventilation, Climatisation)" with colored badge and description. FAMILY FILTERING TEST: Click "MAIN" filter button above search field. Verify button becomes highlighted (blue background, white text). Type "cv" in search. Verify only MAIN subfamilies shown (CVC, etc.). Click "NETT" button. Verify filter switches - button highlighted green, only Nettoyage subfamilies shown. Click "NETT" again. Verify filter deactivated - button returns to normal, all families/subfamilies shown. Test all 7 filter buttons (MAIN, NETT, CTRL, FLUI, ASSU, IMMO, AUTR). KEYBOARD NAVIGATION TEST: Type search query to show results dropdown. Press Arrow Down key multiple times. Verify selection highlight moves down through results. Press Arrow Up key. Verify selection moves up. Verify selected item scrolls into view if needed. Press Enter key. Verify highlighted item is selected and form updated. Press Escape key. Verify dropdown closes. HIERARCHY DISPLAY TEST: Search for "ascenseur". Verify results show both families and subfamilies. For families, verify shows "Famille principale (CODE)". For subfamilies, verify shows "Parent > Subfamily" format (e.g., "Maintenance > Ascenseurs"). Verify family badges are color-coded by parent family. EDGE CASES TEST: Type single character "m". Verify no dropdown appears (minimum 2 chars required). Type "zzzzzzz" (non-existent). Verify "Aucune famille de contrat trouv√©e" message with helpful text. Click outside dropdown. Verify dropdown closes. Start typing, then clear input. Verify dropdown hides. DEBOUNCING TEST: Type rapidly "maintenance". Verify only ONE API call made after 300ms pause (check browser Network tab). Verify no excessive API calls during typing. API ENDPOINT TEST: Open browser DevTools Network tab. Type search query "ctrl". Verify API call to /api/contract_families/autocomplete with correct parameters (query=ctrl, family if filter active). Verify response contains JSON array with contract families including: id, code, name, display_name, family_type, parent_code, hierarchy_path, description, family_badge_color, is_family, is_subfamily, parent_family_name. Verify response limited to 50 results max. FORM INTEGRATION TEST (New): Go to /contracts/new. Fill required fields: contract number, title, type, object, contractor. In "Famille d'Achats" field, search and select "MAIN-CVC". Verify hidden fields populated. Submit form. Verify contract created with contract_family="MAIN-CVC" and purchase_subfamily="CVC (Chauffage, Ventilation, Climatisation)". View created contract details - verify family hierarchy displayed. FORM INTEGRATION TEST (Edit): Edit existing contract (/contracts/:id/edit). Verify autocomplete pre-populated with current family if set (displays full "CODE - Name" format). Change family by searching "flui", select "FLUI-ELE - √âlectricit√©". Submit. Verify contract updated with new family code. VISUAL ELEMENTS TEST: Verify all 7 filter button colors match families: MAIN=Blue, NETT=Green, CTRL=Yellow, FLUI=Purple, ASSU=Red, IMMO=Indigo, AUTR=Gray. Verify loading spinner appears during API call. Verify selected info panel displays with gradient background, colored left border, family badge, full hierarchy, description, type label (Famille/Sous-famille). ORGANIZATION ISOLATION: Login as portfolio@hubsight.com - use autocomplete, verify sees all 42 families+subfamilies (shared reference data). Logout, login as portfolio2@hubsight.com - verify sees same families (not org-scoped). CONTRACT DISPLAY: After creating contract with family, view /contracts/:id. Verify contract family displays with full hierarchy. If contract has contract_family_object, verify displays formatted hierarchy. PERFORMANCE TEST: With all 42 contract families in database, verify autocomplete responds within 500ms. Verify dropdown renders smoothly. Verify keyboard navigation is instant. Verify no console errors. NOTE: Contract families are shared reference data across organizations. The actual contracts linking to them are organization-scoped. See doc/implementation_plan_item_29.md for complete technical documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">30</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Link Services to Contract Families<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Manual linking of services to Contract Family/Subfamily using search system with autocomplete suggestions (Implemented via Task 29)</td>
                    <td class="url-col"><a href="/contracts/new">/contracts/new</a> or <a href="/contracts/1/edit">/contracts/:id/edit</a></td>
                    <td class="test-col">PREREQUISITES: Task 29 (Contract Family Search) provides this functionality. Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /contracts/new or /contracts/:id/edit. Scroll to "Identification du Contrat" section. Locate "Famille d'Achats" field (4th field). Verify 7 filter buttons display (MAIN, NETT, CTRL, FLUI, ASSU, IMMO, AUTR). Type "main" in search (min 2 chars). Verify dropdown with families/subfamilies appears. Click "MAIN-CVC - CVC (Chauffage, Ventilation, Climatisation)". Verify input shows full name, hidden contract_family field contains "MAIN-CVC", subfamily auto-populated. Fill required contract fields (Num√©ro: "TEST-001", Titre: "Test", Type, Objet, Prestataire). In Services & SLA section, fill "Nature des Services" field with service description. Submit form. On contract show page, verify family displays as "MAIN-CVC - CVC", hierarchy shows "Maintenance > CVC", service description appears. This links the contract's services to the family classification. Test keyboard navigation (Arrow keys, Enter, Escape). Test family filters (click MAIN button, type "cv", verify only MAIN subfamilies shown). Test editing: edit contract, change family to "NETT-CLN", verify updates correctly. See doc/implementation_plan_item_30.md for complete testing guide with 10 detailed test scenarios.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">31</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Auto-Calculate Contract Dates</td>
                    <td class="description-col">Automatically calculate last renewal date, contract expiry date, termination deadline, last amount update date based on contract parameters</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">32</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Auto-Calculate VAT Amounts</td>
                    <td class="description-col">Automatically calculate VAT inclusive amounts from exclusive amounts based on configurable VAT rates</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">33</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - View Contract List</td>
                    <td class="description-col">Display contracts in list/table view with pagination, sorting, and column customization</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">34</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Filter Contracts</td>
                    <td class="description-col">Multiple filter options: by site, building, contract family, service provider, status, date ranges, amount ranges</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">35</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create Organizations</td>
                    <td class="description-col">Create and manage organizations (companies) with 12 fields: name, legal name, SIRET, type, address, contacts, specialties, status</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">36</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create Contacts</td>
                    <td class="description-col">Create and manage contacts nested under organizations with 11 fields: name, position, phone, email, availability, languages</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">37</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Create Agencies</td>
                    <td class="description-col">Create and manage agencies/establishments under organizations with address, service area, certifications</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">38</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Organization Search & Autocomplete</td>
                    <td class="description-col">Search and autocomplete for organizations and contacts databases to facilitate manual linking during contract entry</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">39</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Link Organizations to Contracts</td>
                    <td class="description-col">Manual linking of organizations (service providers) to contracts using search system with organization details preview</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">40</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Generate Contract PDF Summary<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Generate PDF summary sheets per contract with emergency numbers, references, equipment list, based on client template</td>
                    <td class="url-col"><a href="/contracts/:id">/contracts/:id</a></td>
                    <td class="test-col">IMPLEMENTATION STATUS: Backend service complete and shared with Task 51. Portfolio Manager implementation ready to use. Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /contracts to view all contracts in organization. Click "Voir" on any contract - redirects to /contracts/:id (contract detail page). PDF GENERATION: The same ContractPdfGenerator service used by Site Managers works for Portfolio Managers. Unlike Site Managers who can only access assigned site contracts, Portfolio Managers can generate PDFs for ANY contract in their organization. TESTING (Same as Task 51 but different authorization): On contract detail page, locate "G√©n√©rer Fiche PDF" button (purple gradient). Click button - verify PDF generates and opens in new tab. FILENAME: "Contrat_[CONTRACT_NUMBER]_[YYYYMMDD].pdf" (e.g., "Contrat_MAIN-2024-001_20251201.pdf"). PDF CONTENT VERIFICATION: Same 10 sections as Task 51: 1) Header with organization/contract info, 2) Emergency contacts (bold red phones), 3) Identification, 4) Stakeholders, 5) Scope with equipment list, 6) Financial aspects, 7) Temporality, 8) Services & SLA, 9) Footer with date and page numbers. AUTHORIZATION DIFFERENCE: Portfolio Managers can generate PDFs for ALL contracts in organization (not limited to specific sites like Site Managers). Test with portfolio@hubsight.com - verify can access any contract. Test with portfolio2@hubsight.com - verify sees different organization's contracts only. SHARED SERVICE: Uses app/services/contract_pdf_generator.rb (same code for both PM and SM roles). ORGANIZATION ISOLATION: Login as portfolio@hubsight.com - generate PDFs for Organization 1 contracts. Logout, login as portfolio2@hubsight.com - verify can only access Organization 2 contracts. No cross-organization data leakage. NOTE: This task shares implementation with Task 51. The same PDF generation service works for both roles with different authorization scopes. See doc/implementation_plan_items_40_and_51.md for complete technical documentation covering both tasks.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">41</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Export Contract List</td>
                    <td class="description-col">Export contract list to Excel/CSV with selected columns and applied filters</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">42</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Export Equipment List</td>
                    <td class="description-col">Export equipment list to Excel/CSV with hierarchy context (site > building > level > space)</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">43</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Export Sites Structure</td>
                    <td class="description-col">Export complete sites structure to Excel with hierarchical indentation or nested sheets</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">44</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Portfolio Overview Dashboard<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Dashboard displaying portfolio overview: total sites, buildings, equipment, contracts, total contract value, key metrics based on backlogs.html</td>
                    <td class="url-col"><a href="/dashboard">/dashboard</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /dashboard. VERIFY 7 KPI CARDS with real database data: 1) Sites Total (13 for Org 1, 12 for Org 2), 2) B√¢timents Total with average per site calculation, 3) Contrats Actifs with coverage percentage, 4) Prestataires showing unique provider count, avg contracts per provider, top provider name and count, 5) Budget Annuel Total showing sum of all contracts, 6) √âconomies Potentielles (locked state - Brick 2), 7) Alertes Actives (Brick 2 coming soon message). VERIFY KEY INDICATORS SECTION: Contrats par Statut (4 statuses with real counts/percentages), Renouvellements √† Venir (30/60/90 days with real counts), D√©penses par Cat√©gorie (total + top 3 families). VERIFY CHARTS: Family Distribution (shows all families with percentages, counts, amounts from database), Top 10 Contracts table (real data with contract numbers, titles, providers, amounts, sites, deadlines), Recent Contracts table (5 most recent with real data, status badges). TEST ORGANIZATION ISOLATION: Logout, login as portfolio2@hubsight.com - verify sees completely different data (12 sites vs 13, different contracts, different providers). Verify no data leakage. TEST MULTI-TENANCY: All queries scoped to current_user.organization_id. Buildings count real from database. Providers statistics calculated from actual contract data. Top contracts sorted by annual_amount DESC. Recent contracts sorted by created_at DESC. Verify sidebar alerts replaced with Brick 2 feature message (üîî icon, "Fonctionnalit√© √† venir", "Les alertes seront disponibles dans Brique 2"). Verify all amounts display without "HT Contrat initial + HT Avenant 1 + HT Avenant 2" text (simplified format). Verify responsive design works on mobile (tables adapt, grid changes to single column).</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">45</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Key Indicators Display<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Display key indicators: contracts by status, contracts by family, upcoming renewals, total spend by category</td>
                    <td class="url-col"><a href="/dashboard">/dashboard</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /dashboard. Verify Key Indicators section displays: 1) Contrats par Statut showing real counts for Actif, En attente, Expir√©, Suspendu with percentages. 2) Renouvellements √† Venir showing contracts expiring in next 30 days (red badge), 31-60 days (yellow badge), 61-90 days (blue badge). 3) D√©penses par Cat√©gorie showing total spending and top 3 families by amount. 4) R√©partition par Famille d'Achats with real percentages, contract counts, and amounts for all families. Verify KPI cards show real data: Sites Total (13), Contrats Actifs (varying count with %), Budget Annuel Total (sum of all contracts). Test multi-tenancy: logout, login as portfolio2@hubsight.com - verify different data shown (12 sites, different contract counts). Verify all data is organization-scoped with no data leakage. Check that indicators update with real database queries, no hardcoded values in Key Indicators section.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">46</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">PM - Analytics Dashboard<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Analytics page with charts and graphs showing contract distribution, spending trends, equipment distribution by type</td>
                    <td class="url-col"><a href="/analytics">/analytics</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Navigate to /analytics. Verify three main sections display: 1) Contract Distribution Analysis showing donut charts for distribution by family (Maintenance CVC, S√©curit√©, Nettoyage, Ascenseurs, √âlectricit√©, Plomberie) and by status (Actif, En renouvellement, Expir√©, Suspendu). 2) Spending Trends Analysis showing budget cards (Budget Total: 1,850,000 ‚Ç¨, D√©penses: 1,810,000 ‚Ç¨, Utilisation: 97.8%), monthly spending chart comparing actual vs budget for 12 months, and spending breakdown by contract family with progress bars. 3) Equipment Distribution Analysis showing total count (555), distribution by OmniClass type (CVC, Ascenseurs, √âclairage, Plomberie, S√©curit√©, etc.), top 10 sites by equipment count bar chart, and age distribution stacked bar (0-5 ans, 6-10 ans, 11-15 ans, 16-20 ans, 20+ ans). Verify all charts render correctly with colors, percentages, and legends. All data is mock data with TODOs for real database queries.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">47</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">SM - View Assigned Sites</td>
                    <td class="description-col">Site Manager can view only sites assigned to them by Portfolio Manager with restricted access to other sites</td>
                    <td class="url-col"><a href="/my_sites">/my_sites</a></td>
                    <td class="test-col">Login as portfolio manager (portfolio@hubsight.com / Password123!). Go to /site_managers, click on a site manager (e.g., Pierre Bernard). Click "G√©rer les Sites" button. Select/deselect sites using checkboxes (try "Tout s√©lectionner"). Verify counter updates. Click "Enregistrer les Assignations". Verify success message and assigned sites list appears on profile. Logout. Login as site manager (sitemanager@hubsight.com / Password123!). Go to /my_sites. Verify ONLY 5 assigned sites visible (not all 13 from organization). Click on an assigned site - should work. Try manually accessing a non-assigned site ID in URL - should redirect with "Vous n'avez pas acc√®s √† ce site" error. Verify site manager cannot see unassigned sites. Test with sitemanager2@hubsight.com to verify different assignments (5 different sites). Test organization isolation: sitemanager3@hubsight.com should only see 4 sites from Organization 2.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">48</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">SM - View Site Contracts<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">View contracts related to assigned sites with read-only access to contract details</td>
                    <td class="url-col"><a href="/my_contracts">/my_contracts</a></td>
                    <td class="test-col">PREREQUISITES: Task 12 (Site Assignment) must be completed. Login as portfolio manager (portfolio@hubsight.com / Password123!). Go to /site_managers, click on a site manager (e.g., Pierre Bernard), click "G√©rer les Sites", assign contracts to some sites (ensure sites have contracts). Logout. LOGIN AS SITE MANAGER (sitemanager@hubsight.com / Password123!). Navigate to /my_contracts via sidebar "Mes Contrats" link. VERIFY: See only contracts for assigned sites (not all contracts). Contracts grouped by site with gradient headers. TEST FILTERS: Select specific site from dropdown - verify shows only that site's contracts. Select family (e.g., "Maintenance") - verify filters work. Select status (e.g., "Actif") - verify filters work. Enter search term (contract number/title/contractor) - verify search works. Click "R√©initialiser" - verify filters reset. TEST CONTRACT VIEW: Click "Voir" on any contract - verify redirects to /my_contracts/:id. Verify shows full contract details in read-only mode. Verify NO edit/delete buttons present. Verify "Acc√®s en lecture seule" warning displayed. Verify site information prominently displayed. Verify emergency contact information shown. TEST PDF: If contract has PDF attached, verify "Voir PDF" button appears. Click button - verify PDF opens in new tab. TEST AUTHORIZATION: Try manually visiting /my_contracts/:id for unassigned site contract - verify redirected with error "Vous n'avez pas acc√®s √† ce contrat." TEST ORGANIZATION ISOLATION: Logout, login as sitemanager3@hubsight.com (Organization 2). Verify sees only Organization 2 contracts from assigned sites. TEST EMPTY STATES: Login as site manager with no assigned sites - verify shows "Aucun site assign√©" message. Login as site manager with assigned sites but no contracts - verify shows "Aucun contrat trouv√©". TEST NAVIGATION: Verify sidebar shows "Mes Contrats" (not "Contrats") for site managers. Verify sidebar shows "Mes Sites" (not "Sites") for site managers. Verify clicking "Retour √† mes contrats" from detail page returns to list.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">49</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">SM - Upload Contracts for Scope<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Upload contract PDFs for sites within their scope, triggering OCR/LLM extraction workflow</td>
                    <td class="url-col"><a href="/my_contracts/new">/my_contracts/new</a></td>
                    <td class="test-col">PREREQUISITES: Task 12 (Site Assignment) and Tasks 24-26 (PDF Upload, OCR, LLM) must be completed. Login as site manager (sitemanager@hubsight.com / Password123!). Navigate to /my_contracts - verify "Nouveau Contrat" button appears in page header. Click "Nouveau Contrat" button - redirects to /my_contracts/new. VIEW FORM: Verify blue info banner displays explaining auto-extraction process. Verify "üìÑ Document PDF du Contrat" section with orange gradient background shows drag-and-drop zone. SITE DROPDOWN TEST: In "Site Associ√©" dropdown, verify ONLY assigned sites appear (not all organization sites). For sitemanager@hubsight.com, should see only 5 assigned sites. Try logging in as sitemanager2@hubsight.com - verify sees different 5 sites. Verify blue info message "üí° Vous ne pouvez s√©lectionner que vos sites assign√©s" displays below dropdown. PDF UPLOAD TEST: Drag a PDF file (under 10MB) over dropzone - verify visual feedback (zone changes color). Drop file - verify green preview box appears showing filename and size with remove button. Click X to remove - verify preview disappears. Click orange "S√©lectionner un fichier" button - verify file picker opens. Select PDF - verify preview appears. Try uploading .jpg/.docx - verify error "Le fichier doit √™tre au format PDF" displays in red. Try uploading PDF >10MB - verify error "Le fichier ne doit pas d√©passer 10 Mo". FORM FIELDS TEST: Fill REQUIRED fields: select site from dropdown, enter contract number (e.g., "SM-TEST-001"), title (e.g., "Test Upload SM"), select contract type, select purchase family. Fill OPTIONAL fields: subfamily, contractor details (organization, contact, email, phone), amounts (HT/TTC), dates (start/end), object, notes. Verify all fields accept input correctly. SUBMIT TEST: With valid PDF and required fields filled, click "T√©l√©charger le Contrat" button. Verify success message "Contrat cr√©√© avec succ√®s. L'extraction des donn√©es va d√©marrer automatiquement." Verify redirects to /my_contracts/:id (contract detail page). EXTRACTION WORKFLOW TEST: On contract detail page, scroll to "Extraction OCR du PDF" section. Verify status badge shows "En attente" (yellow) or "Termin√©" (green). Wait ~5-10 seconds, refresh page. Verify OCR status changes to "Termin√©" with provider "PDF Reader (Gratuit)". Verify "Voir le texte extrait" link appears. Scroll to "Donn√©es Extraites Automatiquement" section. Verify üé≠ "Mode D√©monstration" banner displays. Verify 6 collapsible sections appear with extracted data. AUTHORIZATION TEST: Try manually navigating to /my_contracts/new with no assigned sites - verify redirect to /my_contracts with alert "Aucun site ne vous a √©t√© assign√©." Create contract for assigned site, then login as different site manager - verify cannot access contract (authorization check). VALIDATION TEST: Try submitting form without PDF - verify HTML5 required validation prevents submit. Try submitting without site selected - verify validation error. Try submitting without contract number/title - verify validation errors. CANCEL TEST: Click "Annuler" button - verify redirects back to /my_contracts without creating contract. DB VERIFICATION: After successful upload, verify in database: contract.organization_id matches current_user.organization_id, contract.site_id is in current_user.assigned_sites, contract.pdf_document attached, contract.ocr_status = "pending" or "completed", contract.extraction_status updated when jobs complete.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">50</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">SM - View Site Equipment<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">View list of equipment for assigned sites with hierarchical navigation (building > level > space > equipment)</td>
                    <td class="url-col"><a href="/my_equipment">/my_equipment</a>, <a href="/my_sites/:id/equipment">/my_sites/:id/equipment</a></td>
                    <td class="test-col">PREREQUISITES: Task 12 (Site Assignment) and Task 17 (Equipment) must be completed. Login as portfolio manager (portfolio@hubsight.com / Password123!). Ensure site manager has assigned sites with equipment. Logout. LOGIN AS SITE MANAGER (sitemanager@hubsight.com / Password123!). UNIFIED EQUIPMENT VIEW: Navigate to /my_equipment via sidebar "Mes √âquipements" link. Verify blue "Acc√®s en lecture seule" notice displays. Verify 4 statistics cards show: Total √âquipements, Actifs, En Maintenance, Critiques with real counts. Verify equipment list shows ONLY equipment from assigned sites (not all organization equipment). Verify equipment grouped by site with blue gradient headers showing site name and count. Verify each equipment row shows: name (clickable link), type, manufacturer, location hierarchy (building > level > space), status badge (green/red/yellow), criticality badge. TEST FILTERS: Select site from dropdown - verify filters to that site only. Select status (Actif/Inactif/En maintenance) - verify filtering works. Enter search term (name/manufacturer/model) - verify search works. Click "R√©initialiser" - verify filters reset to show all. TEST EQUIPMENT DETAILS: Click equipment name - verify redirects to /my_equipment/:id. Verify shows complete read-only details: name, type, manufacturer, model, serial number, all technical specs, dates, supplier info, location hierarchy breadcrumb. Verify blue "Acc√®s en lecture seule" notice with message about contacting portfolio manager for modifications. Verify NO edit/delete buttons present. Verify "Retour √† la liste" button returns to /my_equipment. PER-SITE HIERARCHICAL VIEW: Go to /my_sites, click on assigned site, click "Voir les √âquipements" button. Verify redirects to /my_sites/:site_id/equipment. Verify 4 statistics cards show counts for THIS SITE ONLY. Verify hierarchical tree structure: Building (pink header, chevron icon) > Level (cyan header) > Space (green header) > Equipment (white background, compact list). Click building header - verify expands/collapses with chevron rotation. Click level header - verify nested expand/collapse. Click space header - verify equipment list shows/hides. Verify equipment items show: name (clickable), type, manufacturer, status badge, criticality badge, "Voir" button. TEST FILTERS ON HIERARCHICAL VIEW: Select building from dropdown - verify shows only that building's equipment in tree. Select status - verify filters equipment within tree. Enter search term - verify filters equipment. Click "R√©initialiser" - verify resets. Verify help text at bottom: "üí° Astuce: Cliquez sur les en-t√™tes (B√¢timent, Niveau, Espace) pour d√©velopper ou r√©duire les sections". TEST TREE INTERACTION: Verify tree uses existing tree_controller.js Stimulus controller. Verify clicking headers toggles children visibility. Verify chevron icons rotate on expand/collapse. Verify multiple sections can be expanded simultaneously. AUTHORIZATION TESTS: Try accessing /my_equipment/:id for equipment in non-assigned site - verify redirected with "Vous n'avez pas acc√®s √† cet √©quipement" error. Try accessing /my_sites/:id/equipment for non-assigned site - verify redirected with error. ORGANIZATION ISOLATION: Logout, login as sitemanager3@hubsight.com (Organization 2). Verify sees only Organization 2 equipment from assigned sites (different data). Verify no data leakage between organizations. EMPTY STATES: Login as site manager with no assigned sites - verify /my_equipment shows "Aucun site ne vous a √©t√© assign√©" message. Login as site manager with assigned sites but no equipment - verify shows "Aucun √©quipement trouv√©" with helpful message. NAVIGATION: Verify sidebar shows "Mes √âquipements" (not "√âquipements") for site managers with gear icon. Verify breadcrumb navigation works on detail pages. Verify "Retour au site" button on per-site view returns to site detail page. PAGINATION: If >15 equipment, verify pagination appears at bottom of unified view (15 items per page). TEST WITH MULTIPLE ASSIGNED SITES: Ensure site manager has 3+ assigned sites each with equipment. Verify unified view groups by site correctly. Verify per-site view shows only that site's equipment in hierarchy. DB VERIFICATION: Check queries are scoped correctly: Equipment.joins(:site).where(sites: {id: current_user.assigned_site_ids}). Verify organization_id scoping works: equipment.organization_id matches current_user.organization_id.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr class="implemented">
                    <td class="sl-col">51</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">SM - Generate Contract PDF<span class="status-badge status-done">‚úì DONE</span></td>
                    <td class="description-col">Generate and export contract summary sheets in PDF format for contracts within their scope</td>
                    <td class="url-col"><a href="/my_contracts/:id">/my_contracts/:id</a></td>
                    <td class="test-col">PREREQUISITES: Tasks 12 (Site Assignment) and 48 (View Contracts) must be completed. Login as site manager (sitemanager@hubsight.com / Password123!). Navigate to /my_contracts to view contracts for assigned sites. Click "Voir" on any contract - redirects to /my_contracts/:id (contract detail page). PDF GENERATION BUTTON TEST: On contract detail page, locate purple gradient "G√©n√©rer Fiche PDF" button in top-right corner (before "Voir PDF Original" button if contract has uploaded PDF). Click "G√©n√©rer Fiche PDF" button. Verify PDF generates and opens in new tab or downloads automatically. FILENAME VERIFICATION: Check downloaded file named "Contrat_[CONTRACT_NUMBER]_[YYYYMMDD].pdf" (e.g., "Contrat_MAIN-2024-001_20251201.pdf"). PDF CONTENT VERIFICATION: Open PDF and verify contains: 1) HEADER: Purple gradient with "FICHE R√âCAPITULATIVE DE CONTRAT", organization name, contract number, site name. 2) EMERGENCY CONTACTS SECTION (if data present): Light red background, "üö® CONTACTS D'URGENCE" heading, business hours phone (bold red), on-call phone (bold red), emails, response times. 3) IDENTIFICATION: Contract number, type, family, subfamily, status, currency. 4) STAKEHOLDERS: Contractor organization, contact name, email, phone. 5) SCOPE: Site covered, buildings, equipment types, equipment count. 6) EQUIPMENT LIST (if site_id present): Table with Type, Name, Location columns showing up to 20 equipment items with Building > Level > Space hierarchy. 7) FINANCIAL ASPECTS: Annual amounts (HT/TTC), monthly amount, billing frequency/method, payment delay. 8) TEMPORALITY: Signature/start/end dates, duration, automatic renewal, termination notice. 9) SERVICES & SLA: Service nature, intervention frequency, response delays, working hours, 24/7 availability. 10) FOOTER: Generation date/time, page numbers (Page X/Y). VISUAL VERIFICATION: Verify purple/coral color scheme matches app theme. Verify emergency phone numbers in BOLD RED. Verify sections clearly separated with headers. Verify empty fields show "‚Äî". Verify currency formatted as "‚Ç¨", dates as DD/MM/YYYY. AUTHORIZATION TEST: Login as sitemanager@hubsight.com. Try accessing contract from non-assigned site - verify cannot generate PDF (redirected with error). Generate PDF for assigned site contract - verify works. Logout, login as sitemanager2@hubsight.com. Verify can only generate PDFs for their assigned sites' contracts. ORGANIZATION ISOLATION: Login as sitemanager3@hubsight.com (Organization 2). Navigate to their contracts. Generate PDF. Verify shows only Organization 2 data. Verify cannot access Organization 1 contracts/PDFs. EDGE CASES: Test contract without emergency contacts - verify section skipped. Test contract without site_id - verify no equipment list shown. Test contract with 20+ equipment - verify shows "Liste limit√©e aux 20 premiers √©quipements" note. Test contract with minimal data - verify all empty fields show "‚Äî" gracefully. MULTIPLE PDF GENERATION: Click "G√©n√©rer Fiche PDF" multiple times for different contracts. Verify each generates correctly with unique filenames. Verify browser doesn't cache old PDFs. BUTTON VISIBILITY: Verify "G√©n√©rer Fiche PDF" button always visible (regardless of whether contract has uploaded PDF). If uploaded PDF exists, verify both buttons show: "G√©n√©rer Fiche PDF" (purple gradient) and "Voir PDF Original" (green). CONSOLE VERIFICATION (optional): After clicking button, check browser Console for no JavaScript errors. Check Network tab shows GET request to /my_contracts/:id/summary_pdf with 200 response. Verify response Content-Type is application/pdf. NOTE: PDF is generated on-demand (not pre-generated). Each click generates fresh PDF with current data. Expected generation time: < 2 seconds. See doc/implementation_plan_items_40_and_51.md for complete technical documentation.</td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">52</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">System - Data Isolation</td>
                    <td class="description-col">Complete data isolation between clients ensuring no cross-client data access or visibility</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">53</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">System - Responsive Web Design</td>
                    <td class="description-col">Responsive web interface working seamlessly on desktop, tablet, and mobile devices</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">54</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">System - Client Branding</td>
                    <td class="description-col">Clean design with client's graphic charter (logo and colors integration)</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">55</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">System - HTTPS & Security</td>
                    <td class="description-col">Secure hosting in France with HTTPS connections, SSL certificates, and data encryption</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
                <tr>
                    <td class="sl-col">56</td>
                    <td class="brick-col">Brick 1</td>
                    <td class="title-col">System - Global Search</td>
                    <td class="description-col">Global search functionality across contracts, equipment, sites, organizations with faceted filtering</td>
                    <td class="url-col"><span class="empty-cell">-</span></td>
                    <td class="test-col"><span class="empty-cell">-</span></td>
                    <td class="video-col"><span class="empty-cell">-</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>
